<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lesson 6 The Normal Distribution | Empirical Research Methods</title>
  <meta name="description" content="Lesson 6 The Normal Distribution | Empirical Research Methods" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Lesson 6 The Normal Distribution | Empirical Research Methods" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lesson 6 The Normal Distribution | Empirical Research Methods" />
  
  
  

<meta name="author" content="Francis J. DiTraglia" />


<meta name="date" content="2022-04-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="predictive-regression-part-ii.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="images/core-erm-logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About This Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-requisites"><i class="fa fa-check"></i>Pre-requisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#good-coding-style"><i class="fa fa-check"></i>Good Coding Style</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-markdown"><i class="fa fa-check"></i>R Markdown</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-not-stata"><i class="fa fa-check"></i>Why not Stata?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-not-matlab-julia-or-python"><i class="fa fa-check"></i>Why not Matlab, Julia, or Python?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#you-can-help-make-this-book-better"><i class="fa fa-check"></i>You can help make this book better!</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html"><i class="fa fa-check"></i><b>1</b> Running a Simulation Study</a>
<ul>
<li class="chapter" data-level="1.1" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#is-the-hot-hand-an-illusion"><i class="fa fa-check"></i><b>1.1</b> Is the Hot Hand an Illusion?</a></li>
<li class="chapter" data-level="1.2" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#drawing-random-data-in-r"><i class="fa fa-check"></i><b>1.2</b> Drawing Random Data in R</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#sample"><i class="fa fa-check"></i><b>1.2.1</b> <code>sample()</code></a></li>
<li class="chapter" data-level="1.2.2" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#probability-distributions-in-r"><i class="fa fa-check"></i><b>1.2.2</b> Probability Distributions in R</a></li>
<li class="chapter" data-level="1.2.3" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#set.seed"><i class="fa fa-check"></i><b>1.2.3</b> <code>set.seed()</code></a></li>
<li class="chapter" data-level="1.2.4" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#exercises"><i class="fa fa-check"></i><b>1.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#the-skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>1.3</b> The Skeleton of a Simulation Study</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#a-biased-estimator-of-sigma2"><i class="fa fa-check"></i><b>1.3.1</b> A Biased Estimator of <span class="math inline">\(\sigma^2\)</span></a></li>
<li class="chapter" data-level="1.3.2" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#draw_sim_data"><i class="fa fa-check"></i><b>1.3.2</b> <code>draw_sim_data()</code></a></li>
<li class="chapter" data-level="1.3.3" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#get_estimate"><i class="fa fa-check"></i><b>1.3.3</b> <code>get_estimate()</code></a></li>
<li class="chapter" data-level="1.3.4" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#get_bias"><i class="fa fa-check"></i><b>1.3.4</b> <code>get_bias()</code></a></li>
<li class="chapter" data-level="1.3.5" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#running-the-simulation-study"><i class="fa fa-check"></i><b>1.3.5</b> Running the Simulation Study</a></li>
<li class="chapter" data-level="1.3.6" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#expand.grid-and-map"><i class="fa fa-check"></i><b>1.3.6</b> <code>expand.grid()</code> and <code>Map()</code></a></li>
<li class="chapter" data-level="1.3.7" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#formatting-the-results"><i class="fa fa-check"></i><b>1.3.7</b> Formatting the Results</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="running-a-simulation-study.html"><a href="running-a-simulation-study.html#exercise---the-hot-hand"><i class="fa fa-check"></i><b>1.4</b> Exercise - The Hot Hand</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html"><i class="fa fa-check"></i><b>2</b> Getting Started with <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#package-installation"><i class="fa fa-check"></i><b>2.1</b> Package Installation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise"><i class="fa fa-check"></i><b>2.1.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#what-is-a-tibble"><i class="fa fa-check"></i><b>2.2</b> What is a tibble?</a></li>
<li class="chapter" data-level="2.3" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#filter-rows-with-filter"><i class="fa fa-check"></i><b>2.3</b> Filter Rows with <code>filter</code></a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercises-1"><i class="fa fa-check"></i><b>2.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#sort-data-with-arrange"><i class="fa fa-check"></i><b>2.4</b> Sort data with <code>arrange</code></a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercises-2"><i class="fa fa-check"></i><b>2.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#choose-columns-with-select"><i class="fa fa-check"></i><b>2.5</b> Choose columns with <code>select</code></a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-1"><i class="fa fa-check"></i><b>2.5.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#the-summarize-verb"><i class="fa fa-check"></i><b>2.6</b> The <code>summarize</code> verb</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-2"><i class="fa fa-check"></i><b>2.6.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#the-group_by-verb"><i class="fa fa-check"></i><b>2.7</b> The <code>group_by</code> verb</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-3"><i class="fa fa-check"></i><b>2.7.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#understanding-the-pipe"><i class="fa fa-check"></i><b>2.8</b> Understanding the pipe: <code>%&gt;%</code></a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-4"><i class="fa fa-check"></i><b>2.8.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#chaining-commands"><i class="fa fa-check"></i><b>2.9</b> Chaining commands</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-5"><i class="fa fa-check"></i><b>2.9.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#change-an-existing-variable-or-create-a-new-one-with-mutate"><i class="fa fa-check"></i><b>2.10</b> Change an existing variable or create a new one with <code>mutate</code></a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-6"><i class="fa fa-check"></i><b>2.10.1</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html"><i class="fa fa-check"></i><b>3</b> Getting Started with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#a-simple-scatterplot-using-ggplot2"><i class="fa fa-check"></i><b>3.1</b> A simple scatterplot using <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-7"><i class="fa fa-check"></i><b>3.1.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#plotting-on-the-log-scale"><i class="fa fa-check"></i><b>3.2</b> Plotting on the log scale</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-8"><i class="fa fa-check"></i><b>3.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#the-color-and-size-aesthetics"><i class="fa fa-check"></i><b>3.3</b> The color and size aesthetics</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-9"><i class="fa fa-check"></i><b>3.3.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#faceting---plots-for-multiple-subsets"><i class="fa fa-check"></i><b>3.4</b> Faceting - Plots for Multiple Subsets</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-10"><i class="fa fa-check"></i><b>3.4.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#plotting-summarized-data"><i class="fa fa-check"></i><b>3.5</b> Plotting summarized data</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-11"><i class="fa fa-check"></i><b>3.5.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#line-plots"><i class="fa fa-check"></i><b>3.6</b> Line plots</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-12"><i class="fa fa-check"></i><b>3.6.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#bar-plots"><i class="fa fa-check"></i><b>3.7</b> Bar plots</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-13"><i class="fa fa-check"></i><b>3.7.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#cleveland-dot-charts"><i class="fa fa-check"></i><b>3.8</b> Cleveland Dot Charts</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-14"><i class="fa fa-check"></i><b>3.8.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#histograms"><i class="fa fa-check"></i><b>3.9</b> Histograms</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-15"><i class="fa fa-check"></i><b>3.9.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#boxplots"><i class="fa fa-check"></i><b>3.10</b> Boxplots</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-16"><i class="fa fa-check"></i><b>3.10.1</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html"><i class="fa fa-check"></i><b>4</b> Predictive Regression Part I</a>
<ul>
<li class="chapter" data-level="4.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-17"><i class="fa fa-check"></i><b>4.1.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#the-least-squares-problem"><i class="fa fa-check"></i><b>4.2</b> The Least Squares Problem</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-18"><i class="fa fa-check"></i><b>4.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#linear-regression-with-lm"><i class="fa fa-check"></i><b>4.3</b> Linear Regression with <code>lm()</code></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-19"><i class="fa fa-check"></i><b>4.3.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#plotting-the-regression-line"><i class="fa fa-check"></i><b>4.4</b> Plotting the Regression Line</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-20"><i class="fa fa-check"></i><b>4.4.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#getting-more-from-lm"><i class="fa fa-check"></i><b>4.5</b> Getting More from <code>lm()</code></a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-21"><i class="fa fa-check"></i><b>4.5.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#summarizing-the-ouput-of-lm"><i class="fa fa-check"></i><b>4.6</b> Summarizing The Ouput of <code>lm()</code></a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-22"><i class="fa fa-check"></i><b>4.6.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#tidying-up-with-broom"><i class="fa fa-check"></i><b>4.7</b> Tidying up with <code>broom</code></a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-23"><i class="fa fa-check"></i><b>4.7.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#dummy-variables-with-lm"><i class="fa fa-check"></i><b>4.8</b> Dummy Variables with <code>lm()</code></a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-24"><i class="fa fa-check"></i><b>4.8.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#fun-with-r-formulas"><i class="fa fa-check"></i><b>4.9</b> Fun with R Formulas</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#everything-else---the-dot-."><i class="fa fa-check"></i><b>4.9.1</b> "Everything Else" - The Dot <code>.</code></a></li>
<li class="chapter" data-level="4.9.2" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#removing-predictors-with--"><i class="fa fa-check"></i><b>4.9.2</b> Removing Predictors with <code>-</code></a></li>
<li class="chapter" data-level="4.9.3" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#the-intercept-1"><i class="fa fa-check"></i><b>4.9.3</b> The Intercept: <code>1</code></a></li>
<li class="chapter" data-level="4.9.4" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-25"><i class="fa fa-check"></i><b>4.9.4</b> Exercise</a></li>
<li class="chapter" data-level="4.9.5" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#transforming-outcomes-and-predictors"><i class="fa fa-check"></i><b>4.9.5</b> Transforming Outcomes and Predictors</a></li>
<li class="chapter" data-level="4.9.6" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#adding-interactions-with-and"><i class="fa fa-check"></i><b>4.9.6</b> Adding Interactions With <code>:</code>, <code>*</code>, and <code>^</code></a></li>
<li class="chapter" data-level="4.9.7" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-26"><i class="fa fa-check"></i><b>4.9.7</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html"><i class="fa fa-check"></i><b>5</b> Predictive Regression Part II</a>
<ul>
<li class="chapter" data-level="5.1" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#regressions-used-below"><i class="fa fa-check"></i><b>5.1</b> Regressions Used Below</a></li>
<li class="chapter" data-level="5.2" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#predicting-new-observations"><i class="fa fa-check"></i><b>5.2</b> Predicting New Observations</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#exercise-27"><i class="fa fa-check"></i><b>5.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#testing-a-linear-restriction"><i class="fa fa-check"></i><b>5.3</b> Testing a Linear Restriction</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#exercise-28"><i class="fa fa-check"></i><b>5.3.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#heteroskedasticity-robust-standard-errors-and-tests"><i class="fa fa-check"></i><b>5.4</b> Heteroskedasticity-Robust Standard Errors and Tests</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#exercise-29"><i class="fa fa-check"></i><b>5.4.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#publication-quality-tables"><i class="fa fa-check"></i><b>5.5</b> Publication Quality Tables</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#datasummary_skim"><i class="fa fa-check"></i><b>5.5.1</b> <code>datasummary_skim()</code></a></li>
<li class="chapter" data-level="5.5.2" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#datasummary_balance"><i class="fa fa-check"></i><b>5.5.2</b> <code>datasummary_balance()</code></a></li>
<li class="chapter" data-level="5.5.3" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#modelsummary"><i class="fa fa-check"></i><b>5.5.3</b> <code>modelsummary()</code></a></li>
<li class="chapter" data-level="5.5.4" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#robust-standard-errors"><i class="fa fa-check"></i><b>5.5.4</b> Robust Standard Errors</a></li>
<li class="chapter" data-level="5.5.5" data-path="predictive-regression-part-ii.html"><a href="predictive-regression-part-ii.html#exercise-30"><i class="fa fa-check"></i><b>5.5.5</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html"><i class="fa fa-check"></i><b>6</b> The Normal Distribution</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#standard-normals-as-building-blocks"><i class="fa fa-check"></i><b>6.1</b> Standard Normals as Building Blocks</a></li>
<li class="chapter" data-level="6.2" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#the-one-dimensional-case"><i class="fa fa-check"></i><b>6.2</b> The One-Dimensional Case</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#pnorm"><i class="fa fa-check"></i><b>6.2.1</b> <code>pnorm()</code></a></li>
<li class="chapter" data-level="6.2.2" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#dnorm"><i class="fa fa-check"></i><b>6.2.2</b> <code>dnorm()</code></a></li>
<li class="chapter" data-level="6.2.3" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#qnorm"><i class="fa fa-check"></i><b>6.2.3</b> <code>qnorm()</code></a></li>
<li class="chapter" data-level="6.2.4" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#rnorm"><i class="fa fa-check"></i><b>6.2.4</b> <code>rnorm()</code></a></li>
<li class="chapter" data-level="6.2.5" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#pqdrnorm-are-vectorized"><i class="fa fa-check"></i><b>6.2.5</b> <code>p/q/d/rnorm()</code> are Vectorized</a></li>
<li class="chapter" data-level="6.2.6" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#be-careful"><i class="fa fa-check"></i><b>6.2.6</b> Be Careful!</a></li>
<li class="chapter" data-level="6.2.7" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#exercises-3"><i class="fa fa-check"></i><b>6.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#generating-correlated-normal-rvs"><i class="fa fa-check"></i><b>6.3</b> Generating Correlated Normal RVs</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#start-with-uncorrelated-normal-draws"><i class="fa fa-check"></i><b>6.3.1</b> Start with Uncorrelated Normal Draws</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#exercise-31"><i class="fa fa-check"></i><b>6.3.2</b> Exercise</a></li>
<li class="chapter" data-level="6.3.3" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#add-constants-to-shift-the-means"><i class="fa fa-check"></i><b>6.3.3</b> Add Constants to Shift the Means</a></li>
<li class="chapter" data-level="6.3.4" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#exercise-32"><i class="fa fa-check"></i><b>6.3.4</b> Exercise</a></li>
<li class="chapter" data-level="6.3.5" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#multiply-by-scalars-to-change-the-variance"><i class="fa fa-check"></i><b>6.3.5</b> Multiply by Scalars to Change the Variance</a></li>
<li class="chapter" data-level="6.3.6" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#combine-to-create-correlation"><i class="fa fa-check"></i><b>6.3.6</b> Combine to Create Correlation</a></li>
<li class="chapter" data-level="6.3.7" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#exercise-33"><i class="fa fa-check"></i><b>6.3.7</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#the-cholesky-decomposition"><i class="fa fa-check"></i><b>6.4</b> The Cholesky Decomposition</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#going-backwards"><i class="fa fa-check"></i><b>6.4.1</b> Going Backwards</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#exercise-34"><i class="fa fa-check"></i><b>6.4.2</b> Exercise</a></li>
<li class="chapter" data-level="6.4.3" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#whats-the-square-root-of-a-matrix"><i class="fa fa-check"></i><b>6.4.3</b> What's the Square Root of a Matrix?</a></li>
<li class="chapter" data-level="6.4.4" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#exercise-35"><i class="fa fa-check"></i><b>6.4.4</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#epilogue"><i class="fa fa-check"></i><b>6.5</b> Epilogue</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#affine-transformations-of-a-multivariate-normal"><i class="fa fa-check"></i><b>6.5.1</b> Affine Transformations of a Multivariate Normal</a></li>
<li class="chapter" data-level="6.5.2" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#conditional-distributions-of-bivariate-normal"><i class="fa fa-check"></i><b>6.5.2</b> Conditional Distributions of Bivariate Normal</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="the-normal-distribution.html"><a href="the-normal-distribution.html#problem-set"><i class="fa fa-check"></i><b>6.6</b> Problem Set</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Empirical Research Methods</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-normal-distribution" class="section level1" number="6">
<h1><span class="header-section-number">Lesson 6</span> The Normal Distribution</h1>
<blockquote>
<p>If you hear a "prominent" economist using the word "equilibrium," or "normal distribution," do not argue with him; just ignore him, or try to put a rat down his shirt.</p>
<p>-- Nassim Nicholas Taleb</p>
</blockquote>
<div style="float:left;position: relative; margin-right: 10px; height: 30%;">
<div class="figure">
<img src="https://i.etsystatic.com/5516807/r/il/685554/148567721/il_fullxfull.148567721.jpg" height="250" alt="" />
<p class="caption">The standard normal distribution.</p>
</div>
</div>
<p>Taleb's exhortation notwithstanding, this lesson is all about the normal distribution! While its importance as a description of naturally-occurring data has probably been overstated, the normal distribution still plays a central role in econometrics and statistics. This isn't because data follow a normal distribution; it's because <em>sampling distributions of estimators</em> tend to, at least <a href="https://en.wikipedia.org/wiki/Central_limit_theorem">in large samples</a>. The normal distribution is also important in model-building because we can use it as an <em>ingredient</em> to construct relatively simple models of complicated phenomena.</p>
<p>From your introductory coursework in statistics and econometrics you're probably familiar with the one-dimensional normal distribution. This lesson will build on the intuition you already have in the one-dimensional case to help you gain a deeper understanding of the <em>multivariate</em> normal distribution. There's a good chance that you've seen some of this material before. But from past experience, many students are a bit fuzzy on the details.</p>
<p>We'll start by reviewing the key commands for working with normal distributions in R: <code>d/p/q/rnorm()</code>. These will come up again and again in future lessons. Then we'll take up the challenge of simulating <em>correlated</em> normal draws. Along the way we'll learn how to calculate column means, variance-covariance matrices, and correlation matrices with the commands <code>colMeans()</code>, <code>cov()</code>, <code>cor()</code> and <code>cov2cor()</code>. We'll also learn to make <em>kernel density plots</em> using the <code>ggplot</code> commands <code>geom_density()</code> and <code>geom_density2d_filled()</code>. Our destination in this lecture is the <em>Cholesky Decomposition</em>, an important result from matrix algebra that's extremely helpful for understanding multivariate normal distributions. We'll work up to this result in easy steps, introducing some basic R commands for matrix algebra as we go, including <code>%*%</code>, <code>t()</code>, and <code>chol()</code>. At the very end, once you know how to generate correlated normals <em>from scratch</em>, I'll relent and allow you to use the extremely helpful command <code>rmvnorm()</code> from the <code>mvtnorm</code> package instead. An appendix to this lesson makes the case for why doing things "the hard way" before you allow yourself to use a canned function like <code>rmvnorm()</code> is worth the trouble.</p>
<div id="standard-normals-as-building-blocks" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Standard Normals as Building Blocks</h2>
<div style="float:left;position: relative; margin-right: 10px; height: 30%;">
<div class="figure">
<img src="http://www.andrewlipson.com/escher/relativity-1600.jpg" height="250" alt="" />
<p class="caption">Escher's "Relativity" in Lego by <a href="http://www.andrewlipson.com/escher/relativity.html">Andrew Lipson</a></p>
</div>
</div>
<p>What's the definition of a <span class="math inline">\(\text{N}(\mu, \sigma^2)\)</span> random variable? You might be tempted to write down a probability density function, but I have a better idea: let's pass the buck! The <span class="math inline">\(\text{N}(\mu, \sigma^2)\)</span> distribution is what you end up with if you shift and scale a standard normal. In particular: we say that <span class="math inline">\(X \sim \text{N}(\mu, \sigma^2)\)</span> if <span class="math inline">\(X = \mu + \sigma Z\)</span> for some constants <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma &gt; 0\)</span>, where <span class="math inline">\(Z\)</span> is a standard normal random variable. From this perspective, any properties of normal distributions <em>in general</em> follow from properties of the standard normal distribution <em>in particular</em>. Because the standard normal distribution is fairly simple, this turns out to be a very convenient approach.</p>
<p>One-dimensional normal distributions can only take us so far. In many important applications we need to work with two or more <em>correlated</em> normal random variables. For example, to run a simulation study exploring the properties of the instrumental variables estimator we need a way of creating correlated "first stage" and "second stage" errors. Fortunately we can use the same basic approach as above to build up a multivariate normal random <em>vector</em> <span class="math inline">\(\mathbf{X}\)</span>. We start with a vector of independent standard normals, scale them with a matrix of constants and shift them with a vector of yet more constants. In other words: <span class="math inline">\(\mathbf{X} = \boldsymbol{\mu} + \mathbf{A}\mathbf{Z}\)</span>. If this looks forbidding, don't worry; we'll build up the intuition step-by-step in this lesson. For the moment, simply take my word for it: the <a href="https://en.wikipedia.org/wiki/Multivariate_normal_distribution">multivariate normal distribution</a> becomes much less formidable once you break it down into its constituent independent standard normals.</p>
</div>
<div id="the-one-dimensional-case" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> The One-Dimensional Case</h2>
<p>We'll start a quick review of the one-dimensional case. After introducing the key R functions for normal distributions, I'll turn you loose on some simple exercises.</p>
<div id="pnorm" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> <code>pnorm()</code></h3>
<p>The R function for the cumulative distribution function (CDF) of a standard normal is <code>pnorm()</code>. In other words, <span class="math inline">\(\mathbb{P}(Z\leq z) = \texttt{pnorm}(z)\)</span> for <span class="math inline">\(Z\sim \text{N}(0,1)\)</span>. So what about the CDF of <span class="math inline">\(X \sim \text{N}(0, \sigma^2)\)</span>? Since <span class="math inline">\((X - \mu) / \sigma \sim \text{N}(0,1)\)</span>, we have
<span class="math display">\[
\mathbb{P}(X\leq x) = \mathbb{P}\left( \frac{X - \mu}{\sigma}  \leq \frac{x - \mu}{\sigma} \right) = \texttt{pnorm}\left(\frac{x - \mu}{\sigma}\right).
\]</span>
This shows that we don't actually <em>need</em> a separate function for general normal distributions: we can do everything with <code>pnorm()</code> after subtracting the mean (centering) and dividing by the standard deviation (standardizing). For convenience, R allows us to supply a <code>mean</code> and standard deviation <code>sd</code> to <code>pnorm()</code> to obtain the CDF of an arbitrary normal random variable. This gives exactly the same result as centering and standardizing:</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="the-normal-distribution.html#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 0.3694413</code></pre>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="the-normal-distribution.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>((<span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 0.3694413</code></pre>
</div>
<div id="dnorm" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> <code>dnorm()</code></h3>
<p>The R function for the probability density function of a standard normal is <code>dnorm()</code>. The function <code>dnorm()</code> is the <em>derivative</em> of the function <code>pnorm()</code>. As with <code>pnorm()</code>, R allows us to supply a <code>mean</code> and standard deviation <code>sd</code> to obtain the density of a <span class="math inline">\(\text{N}(\mu, \sigma^2)\)</span> random variable, but this is only for convenience since
<span class="math display">\[
\frac{d}{dx} \mathbb{P}(X\leq x) = \frac{d}{dx} \text{pnorm} \left(\frac{x - \mu}{\sigma}\right) = \frac{1}{\sigma}\texttt{dnorm}\left(\frac{x - \mu}{\sigma}\right).
\]</span>
Accordingly, both of these give the same answer, although the first is easier to read:</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="the-normal-distribution.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 0.1257944</code></pre>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="the-normal-distribution.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dnorm</span>((<span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">/</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 0.1257944</code></pre>
</div>
<div id="qnorm" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> <code>qnorm()</code></h3>
<p>The R function for the quantile function of a standard normal distribution is <code>qnorm()</code>. This is the <em>inverse</em> of the function <code>pnorm()</code>. jWhereas <code>pnorm(z)</code> returns the probability that <span class="math inline">\(Z \sim \text{N}(0,1)\)</span> takes on a value no greater than <code>z</code>, <code>pnorm(p)</code> returns the value of <code>z</code> such that <span class="math inline">\(\mathbb{P}(Z \leq z) = p\)</span>. This means that <code>qnorm(pnorm(z))</code> equals <code>z</code> and <code>pnorm(qnorm(p))</code> equals <code>p</code>. For example:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="the-normal-distribution.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fu">pnorm</span>(<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="the-normal-distribution.html#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="fu">qnorm</span>(<span class="fl">0.3</span>))</span></code></pre></div>
<pre><code>## [1] 0.3</code></pre>
<p>Like <code>dnorm()</code> and <code>pnorm()</code>, <code>qnorm()</code> allows us to specify a <code>mean</code> and standard deviation <code>sd</code> to obtain quantiles of an arbitrary normal random variable. But again, this is merely for convenience. Since <span class="math inline">\(\mathbb{P}(X \leq x) = \texttt{pnorm}\big((x - \mu)/\sigma\big)\)</span>,
<span class="math display">\[
\begin{aligned}
\mathbb{P}(X \leq x) &amp;= p\\
\texttt{qnorm}\left( \mathbb{P}(X \leq x) \right) &amp;= \texttt{qnorm}(p)\\
\texttt{qnorm}\left( \texttt{pnorm}\left(\frac{x - \mu}{\sigma} \right) \right) &amp;= \texttt{qnorm}(p)\\
\frac{x - \mu}{\sigma} &amp;= \texttt{qnorm}(p)\\
x &amp;= \mu + \sigma \times \texttt{qnorm}(p)
\end{aligned}
\]</span>
In words: the <span class="math inline">\(p\)</span>th quantile of a <span class="math inline">\(\text{N}(\mu, \sigma^2)\)</span> RV equals <span class="math inline">\(\mu\)</span> plus <span class="math inline">\(\sigma\)</span> times the <span class="math inline">\(p\)</span>th quantile of a <em>standard</em> normal. For example:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="the-normal-distribution.html#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fl">0.75</span>, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 4.023469</code></pre>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="the-normal-distribution.html#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">qnorm</span>(<span class="fl">0.75</span>)</span></code></pre></div>
<pre><code>## [1] 4.023469</code></pre>
</div>
<div id="rnorm" class="section level3" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> <code>rnorm()</code></h3>
<p>The R function for making simulated standard normal draws is <code>rnorm()</code>. For example, we can make ten standard normal draws as follows</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="the-normal-distribution.html#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1066</span>)</span>
<span id="cb468-2"><a href="the-normal-distribution.html#cb468-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] -0.5917632  0.2926060 -0.9212630  0.2399853  0.9197199 -0.7864827
##  [7]  2.8104984 -0.9771701  1.7462778  0.1523001</code></pre>
<p>To obtain draws from a general normal distribution we can set the optional arguments <code>mean</code> and <code>sd</code> as above. But as above, this is only for convenience. Remember that we <em>defined</em> a <span class="math inline">\(\text{N}(\mu, \sigma^2)\)</span> as what you get by shifting and scaling a standard normal. This means that shifting and scaling standard normal <em>simulation draws</em> is the same thing as simulating a <span class="math inline">\(\mathbf{N}(\mu, \sigma^2)\)</span> random variable, for example:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="the-normal-distribution.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1066</span>)</span>
<span id="cb470-2"><a href="the-normal-distribution.html#cb470-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb470-3"><a href="the-normal-distribution.html#cb470-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1066</span>)</span>
<span id="cb470-4"><a href="the-normal-distribution.html#cb470-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb470-5"><a href="the-normal-distribution.html#cb470-5" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(x, y)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="pqdrnorm-are-vectorized" class="section level3" number="6.2.5">
<h3><span class="header-section-number">6.2.5</span> <code>p/q/d/rnorm()</code> are Vectorized</h3>
<p>R accepts a vector as first argument to <code>pnorm()</code>, <code>dnorm()</code>, and <code>qnorm()</code>. This is very handy in practice, since it allows us to calculate the normal CDF/density/quantile function at many points in a single command. For example,</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="the-normal-distribution.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dnorm</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">1.96</span>))</span></code></pre></div>
<pre><code>## [1] 0.05844094 0.24197072 0.39894228 0.24197072 0.05844094</code></pre>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="the-normal-distribution.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">1.96</span>))</span></code></pre></div>
<pre><code>## [1] 0.0249979 0.1586553 0.5000000 0.8413447 0.9750021</code></pre>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="the-normal-distribution.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.16</span>, <span class="fl">0.5</span>, <span class="fl">0.84</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>## [1] -1.9599640 -0.9944579  0.0000000  0.9944579  1.9599640</code></pre>
<p>The function <code>rnorm()</code> is a bit different. Its first argument is the <em>number</em> of normal simulation draws we wish to make. When we pass it a vector as its first argument, <code>rnorm()</code> calculates the <em>length</em> of the vector and returns an equivalent number of normal draws:</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="the-normal-distribution.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] -0.56094004  0.27176376  0.47237903  0.62703516  0.01277877</code></pre>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="the-normal-distribution.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1]  0.01787882  0.31304030 -1.27600303</code></pre>
<p>All four of the <code>p/q/d/rnorm()</code> functions accept a vector for their <code>mean</code> and <code>sd</code> arguments. This too can be handy in practice. We can use it, for example, to make normal draws with different means</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="the-normal-distribution.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="at">mean =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="at">sd =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] -102.7192  104.0509</code></pre>
<p>different variances</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="the-normal-distribution.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>))</span></code></pre></div>
<pre><code>## [1]    0.6451931 -110.0389461</code></pre>
<p>or both</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="the-normal-distribution.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="at">mean =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>), <span class="at">sd =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] -9.995741  9.983758</code></pre>
</div>
<div id="be-careful" class="section level3" number="6.2.6">
<h3><span class="header-section-number">6.2.6</span> Be Careful!</h3>
<p>A common R mistake is specifying the <em>variance</em> rather than standard deviation inside of <code>dnorm()</code>, <code>pnorm()</code>, <code>qnorm()</code>, or <code>rnorm()</code>. The best way to avoid making this mistake is by explicitly writing <code>sd = [YOUR SD HERE]</code>. For example, <code>dnorm(2, mean = 1, sd = 3)</code> is much less likely to lead to confusion than <code>dnorm(2, 1, 3)</code> although both produce the same result:</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="the-normal-distribution.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">dnorm</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>), <span class="fu">dnorm</span>(<span class="dv">2</span>, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="dv">3</span>))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="exercises-3" class="section level3" number="6.2.7">
<h3><span class="header-section-number">6.2.7</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>Simulate 1000 normal draws with mean -3 and variance 4. Calculate the sample mean and variance of your simulation draws.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="the-normal-distribution.html#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1693</span>)</span>
<span id="cb490-2"><a href="the-normal-distribution.html#cb490-2" aria-hidden="true" tabindex="-1"></a>sims <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="at">mean =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">2</span>) </span>
<span id="cb490-3"><a href="the-normal-distribution.html#cb490-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">sample_mean =</span> <span class="fu">mean</span>(sims), <span class="at">sample_var =</span> <span class="fu">var</span>(sims))</span></code></pre></div>
<pre><code>## sample_mean  sample_var 
##   -2.984270    3.890881</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Transform your simulations from the preceding part so that they have a sample mean of zero and sample standard deviation of one. Check that your transformation worked as expected.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="the-normal-distribution.html#cb492-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> (sims <span class="sc">-</span> <span class="fu">mean</span>(sims)) <span class="sc">/</span> <span class="fu">sd</span>(sims)</span>
<span id="cb492-2"><a href="the-normal-distribution.html#cb492-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">sample_mean =</span> <span class="fu">mean</span>(z), <span class="at">sample_var =</span> <span class="fu">var</span>(z))</span></code></pre></div>
<pre><code>##  sample_mean   sample_var 
## 6.704999e-17 1.000000e+00</code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Calculate the probability that a normal random variable with mean 2 and variance 9 takes on a value <em>greater than</em> 5.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="the-normal-distribution.html#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="dv">5</span>, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 0.1586553</code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Calculate the probability that a standard normal random variable takes on a value between -1 and 2.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="the-normal-distribution.html#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="dv">2</span>) <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.8185946</code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>Find the value of <span class="math inline">\(k\)</span> such that a standard normal random variable has a 50% probability of falling in the interval <span class="math inline">\([-k, k]\)</span>. Use <code>pnorm()</code> to check your work.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="the-normal-distribution.html#cb498-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">qnorm</span>(<span class="fl">0.25</span>)</span>
<span id="cb498-2"><a href="the-normal-distribution.html#cb498-2" aria-hidden="true" tabindex="-1"></a>k</span></code></pre></div>
<pre><code>## [1] 0.6744898</code></pre>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="the-normal-distribution.html#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(k) <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="sc">-</span>k)</span></code></pre></div>
<pre><code>## [1] 0.5</code></pre>
</div>
<ol start="6" style="list-style-type: decimal">
<li>Use <code>dnorm()</code> to plot the density of a standard normal random variable with mean 1 and variance 1/9 <em>without</em> using the <code>mean</code> and <code>sd</code> arguments. Approximately what is the <em>maximum</em> value of the density function? Is this a mistake?!</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="the-normal-distribution.html#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb502-2"><a href="the-normal-distribution.html#cb502-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="at">len =</span> <span class="dv">100</span>)</span>
<span id="cb502-3"><a href="the-normal-distribution.html#cb502-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">dnorm</span>(<span class="dv">3</span> <span class="sc">*</span> (x <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb502-4"><a href="the-normal-distribution.html#cb502-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(x, y)) <span class="sc">+</span></span>
<span id="cb502-5"><a href="the-normal-distribution.html#cb502-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(x, y))</span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-267-1.png" width="672" /></p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="the-normal-distribution.html#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(y)</span></code></pre></div>
<pre><code>## [1] 1.196277</code></pre>
</div>
</div>
</div>
<div id="generating-correlated-normal-rvs" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Generating Correlated Normal RVs</h2>
<div id="start-with-uncorrelated-normal-draws" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Start with Uncorrelated Normal Draws</h3>
<p>We'll start by generating a large number of draws to represent two <em>independent</em> standard normals: <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span></p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="the-normal-distribution.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">99999</span>)</span>
<span id="cb505-2"><a href="the-normal-distribution.html#cb505-2" aria-hidden="true" tabindex="-1"></a>large_number <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb505-3"><a href="the-normal-distribution.html#cb505-3" aria-hidden="true" tabindex="-1"></a>z1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(large_number)</span>
<span id="cb505-4"><a href="the-normal-distribution.html#cb505-4" aria-hidden="true" tabindex="-1"></a>z2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(large_number)</span>
<span id="cb505-5"><a href="the-normal-distribution.html#cb505-5" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">cbind</span>(z1, z2)</span>
<span id="cb505-6"><a href="the-normal-distribution.html#cb505-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(z1, z2)</span></code></pre></div>
<p>Now we have a <em>matrix</em> with two columns: the first is <code>z1</code> and the second is <code>z2</code></p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="the-normal-distribution.html#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(z)</span></code></pre></div>
<pre><code>##              z1          z2
## [1,] -0.4255127 -1.91351696
## [2,] -0.2829203  0.05775194
## [3,] -0.8986773 -0.48302150
## [4,]  0.7065184 -2.37167063
## [5,]  2.0916699  0.35882645
## [6,]  1.6356643 -0.54297591</code></pre>
<p>To calculate the sample mean of each column, we can use the function <code>colMeans()</code></p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="the-normal-distribution.html#cb508-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(z)</span></code></pre></div>
<pre><code>##           z1           z2 
## -0.001512035  0.002202837</code></pre>
<p>To calculate the sample variance of each column of <code>z</code> along with the covariance between them in one fell swoop, we use the <code>cov()</code> function:</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="the-normal-distribution.html#cb510-1" aria-hidden="true" tabindex="-1"></a>cov_mat <span class="ot">&lt;-</span> <span class="fu">cov</span>(z)</span>
<span id="cb510-2"><a href="the-normal-distribution.html#cb510-2" aria-hidden="true" tabindex="-1"></a>cov_mat</span></code></pre></div>
<pre><code>##             z1          z2
## z1 1.006378316 0.000473838
## z2 0.000473838 1.003673852</code></pre>
<p>This is the <em>sample variance-covariance matrix</em> of <code>z</code>. Its diagonal elements are the sample variances of <code>z1</code> and <code>z2</code>, and its off-diagonal elements are the covariance between them. Because we simulated uncorrelated standard normal draws, the diagonal elements are approximately one and the off-diagonals are approximately zero. And since <code>cov(z1, z2)</code> equals <code>cov(z2, z1)</code>, this matrix is <em>symmetric</em>; its <code>[i,j]</code> element equals its <code>[j,i]</code> element:</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="the-normal-distribution.html#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(cov_mat[<span class="dv">1</span>, <span class="dv">2</span>], cov_mat[<span class="dv">2</span>, <span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 0.000473838 0.000473838</code></pre>
<p>When you supply a matrix as your argument, <code>var()</code> and <code>cov()</code> give exactly the same result:</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="the-normal-distribution.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">var</span>(z), <span class="fu">cov</span>(z))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>That's because the variance-covariance matrix contains variances and covariances! To obtain the sample correlation matrix, use the function <code>cor()</code>:</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="the-normal-distribution.html#cb516-1" aria-hidden="true" tabindex="-1"></a>cor_mat <span class="ot">&lt;-</span> <span class="fu">cor</span>(z)</span>
<span id="cb516-2"><a href="the-normal-distribution.html#cb516-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(z)</span></code></pre></div>
<pre><code>##              z1           z2
## z1 1.0000000000 0.0004714688
## z2 0.0004714688 1.0000000000</code></pre>
<p>Now the diagonal elements are one: <code>z1</code> is perfectly correlated with <em>itself</em> and so is <code>z2</code>. The off-diagonal elements are the correlation between <code>z1</code> and <code>z2</code>. Again, this matrix is symmetric since <code>cor(z1, z2)</code> equals <code>cor(z2, z1)</code>. Given a covariance matrix we can immediately compute the associated correlation matrix by dividing each covariance by the appropriate product of standard deviations:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="the-normal-distribution.html#cb518-1" aria-hidden="true" tabindex="-1"></a>cov_mat[<span class="dv">1</span>, <span class="dv">2</span>] <span class="sc">/</span> (<span class="fu">sqrt</span>(cov_mat[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">*</span> cov_mat[<span class="dv">2</span>, <span class="dv">2</span>]))</span></code></pre></div>
<pre><code>## [1] 0.0004714688</code></pre>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="the-normal-distribution.html#cb520-1" aria-hidden="true" tabindex="-1"></a>cor_mat[<span class="dv">1</span>, <span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [1] 0.0004714688</code></pre>
<p>Alternatively we can use the R function <code>cov2cor()</code> to do this for us:</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="the-normal-distribution.html#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cov2cor</span>(cor_mat)</span></code></pre></div>
<pre><code>##              z1           z2
## z1 1.0000000000 0.0004714688
## z2 0.0004714688 1.0000000000</code></pre>
</div>
<div id="exercise-31" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Exercise</h3>
<ol style="list-style-type: decimal">
<li>There's an R function called <code>cov2cor()</code> but there <em>isn't</em> one called <code>cor2cov()</code>. Why not?</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<p>A correlation matrix contains <em>strictly less information</em> than a covariance matrix. If I give you the correlation matrix of <span class="math inline">\((X_1, X_2)\)</span>, then I haven't told you the variances of either <span class="math inline">\(X_1\)</span> or <span class="math inline">\(X_2\)</span>. This means you can't go from a correlation matrix to a covariance matrix, although you can go in the reverse direction.</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Read in the <code>kids</code> dataset from <code>https://ditraglia.com/econ103/child_test_data.csv</code> and calculate the sample means, covariance matrix, and correlation matrix of <code>mom.iq</code> and <code>kid.score</code>.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="the-normal-distribution.html#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb524-2"><a href="the-normal-distribution.html#cb524-2" aria-hidden="true" tabindex="-1"></a>kids <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&#39;https://ditraglia.com/econ103/child_test_data.csv&#39;</span>)</span>
<span id="cb524-3"><a href="the-normal-distribution.html#cb524-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> kids <span class="sc">%&gt;%</span></span>
<span id="cb524-4"><a href="the-normal-distribution.html#cb524-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mom.iq, kid.score)</span>
<span id="cb524-5"><a href="the-normal-distribution.html#cb524-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(dat)</span></code></pre></div>
<pre><code>##    mom.iq kid.score 
## 100.00000  86.79724</code></pre>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="the-normal-distribution.html#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(dat)</span></code></pre></div>
<pre><code>##             mom.iq kid.score
## mom.iq    225.0000  137.2443
## kid.score 137.2443  416.5962</code></pre>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="the-normal-distribution.html#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dat)</span></code></pre></div>
<pre><code>##              mom.iq kid.score
## mom.iq    1.0000000 0.4482758
## kid.score 0.4482758 1.0000000</code></pre>
</div>
</div>
<div id="add-constants-to-shift-the-means" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Add Constants to Shift the Means</h3>
<p>Summary statistics are useful, but pictures are far more informative. A helpful way of visualizing the simulation draws in <code>z</code> is by using <a href="https://en.wikipedia.org/wiki/Kernel_density_estimation">kernel density estimator</a>. We'll discuss the details of kernel density estimation in a future lesson. For now, you can think of it as a "smoothed histogram." For example, here's a pair of histograms for <code>z1</code> and <code>z2</code></p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="the-normal-distribution.html#cb530-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb530-2"><a href="the-normal-distribution.html#cb530-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-3"><a href="the-normal-distribution.html#cb530-3" aria-hidden="true" tabindex="-1"></a>z1_hist <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(z)) <span class="sc">+</span></span>
<span id="cb530-4"><a href="the-normal-distribution.html#cb530-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> z1), <span class="at">fill =</span> <span class="st">&#39;black&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb530-5"><a href="the-normal-distribution.html#cb530-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-6"><a href="the-normal-distribution.html#cb530-6" aria-hidden="true" tabindex="-1"></a>z2_hist <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(z)) <span class="sc">+</span></span>
<span id="cb530-7"><a href="the-normal-distribution.html#cb530-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> z2), <span class="at">fill =</span> <span class="st">&#39;orange&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) </span>
<span id="cb530-8"><a href="the-normal-distribution.html#cb530-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-9"><a href="the-normal-distribution.html#cb530-9" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(z1_hist, z2_hist, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-278-1.png" width="672" /></p>
<p>And here's the kernel density version of the same. Notice that the y-axis is no longer a <em>count</em> of observations that fall in a given bin, but a <em>density</em>; the total area under each curve equals one:</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="the-normal-distribution.html#cb531-1" aria-hidden="true" tabindex="-1"></a>z1_dens <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(z)) <span class="sc">+</span></span>
<span id="cb531-2"><a href="the-normal-distribution.html#cb531-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> z1), <span class="at">fill =</span> <span class="st">&#39;black&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb531-3"><a href="the-normal-distribution.html#cb531-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb531-4"><a href="the-normal-distribution.html#cb531-4" aria-hidden="true" tabindex="-1"></a>z2_dens <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(z)) <span class="sc">+</span></span>
<span id="cb531-5"><a href="the-normal-distribution.html#cb531-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> z2), <span class="at">fill =</span> <span class="st">&#39;orange&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) </span>
<span id="cb531-6"><a href="the-normal-distribution.html#cb531-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb531-7"><a href="the-normal-distribution.html#cb531-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(z1_dens, z2_dens, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-279-1.png" width="672" /></p>
<p>The function <code>geom_density()</code> works in effectively the same way as <code>geom_histogram()</code> but its output is different. The preceding two sets of plots show the <strong>marginal distributions</strong> of <code>z1</code> and <code>z2</code>. This tells us how each random variable behaves taken by itself. To see how <code>z1</code> and <code>z2</code> co-vary, we need to examine the <em>joint distribution</em>. A two-dimensional kernel density plot is helpful way to do this. Rather than trying to plot a 3d surface, we'll take the "view from above," draw in contour lines, and add a color scale using <code>geom_density2d_filled()</code>:</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="the-normal-distribution.html#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(z)) <span class="sc">+</span></span>
<span id="cb532-2"><a href="the-normal-distribution.html#cb532-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> z1, <span class="at">y =</span> z2)) <span class="sc">+</span></span>
<span id="cb532-3"><a href="the-normal-distribution.html#cb532-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="co"># forces the aspect ratio to be 1:1 so you see the circles!</span></span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-280-1.png" width="672" /></p>
<p>The colors are darker in regions of <em>low density</em> and brighter in regions of <em>high density</em>. Because this plot is constructed from simulated data, it's a bit irregular but we can pick out some obvious features. First, the density is clearly highest around the point <span class="math inline">\((0,0)\)</span>, and falls as we move away from this point in any direction. This makes sense: the mean, median, and mode of both <code>z1</code> and <code>z2</code> are all zero. Second, the contours of equal density are <em>circles</em>.</p>
<p>Notice that <span class="math inline">\(z_1\)</span> and <span class="math inline">\(z_2\)</span> only enter this function through the sum of squares <span class="math inline">\((z_1^2 + z_2^2)\)</span>. As long as this quantity remains fixed, the density stays the same. So what kind of shape does the expression <span class="math inline">\((z_1^2 + z_2^2) = c\)</span> describe, for some fixed constant <span class="math inline">\(c\)</span>? A circle centered at <span class="math inline">\((0,0)\)</span>!</p>
<p>It may not surprise you to notice that we can shift the centers of these circles, by adding constants to <code>z1</code> and <code>z2</code>. You won't notice the difference in these plots unless you look carefully: only the axes have changed:</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="the-normal-distribution.html#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shift the means from (0,0) to (1,-1)</span></span>
<span id="cb533-2"><a href="the-normal-distribution.html#cb533-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">x1 =</span> z[,<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span>, <span class="at">x2 =</span> z[,<span class="dv">2</span>] <span class="sc">-</span> <span class="dv">1</span>) </span>
<span id="cb533-3"><a href="the-normal-distribution.html#cb533-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-4"><a href="the-normal-distribution.html#cb533-4" aria-hidden="true" tabindex="-1"></a>x_marginals <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(x)) <span class="sc">+</span></span>
<span id="cb533-5"><a href="the-normal-distribution.html#cb533-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1), <span class="at">fill =</span> <span class="st">&#39;black&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb533-6"><a href="the-normal-distribution.html#cb533-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> x2), <span class="at">fill =</span> <span class="st">&#39;orange&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb533-7"><a href="the-normal-distribution.html#cb533-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;&#39;</span>)</span>
<span id="cb533-8"><a href="the-normal-distribution.html#cb533-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-9"><a href="the-normal-distribution.html#cb533-9" aria-hidden="true" tabindex="-1"></a>x_joint <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(x)) <span class="sc">+</span></span>
<span id="cb533-10"><a href="the-normal-distribution.html#cb533-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2)) <span class="sc">+</span></span>
<span id="cb533-11"><a href="the-normal-distribution.html#cb533-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()  <span class="co"># forces the aspect ratio to be 1:1 so you see the circles!</span></span>
<span id="cb533-12"><a href="the-normal-distribution.html#cb533-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-13"><a href="the-normal-distribution.html#cb533-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(x_marginals, x_joint, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-281-1.png" width="672" /></p>
</div>
<div id="exercise-32" class="section level3" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> Exercise</h3>
<ol style="list-style-type: decimal">
<li>Continuing from the exercise from above, create both marginal and joint kernel density plots of <code>mom.iq</code> and <code>kid.score</code>. Do these appear to be normally distributed?</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="the-normal-distribution.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(kids) <span class="sc">+</span></span>
<span id="cb534-2"><a href="the-normal-distribution.html#cb534-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> mom.iq), <span class="at">fill =</span> <span class="st">&#39;black&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-282-1.png" width="672" /></p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="the-normal-distribution.html#cb535-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(kids) <span class="sc">+</span> </span>
<span id="cb535-2"><a href="the-normal-distribution.html#cb535-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> kid.score), <span class="at">fill =</span> <span class="st">&#39;orange&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-282-2.png" width="672" /></p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="the-normal-distribution.html#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(kids) <span class="sc">+</span></span>
<span id="cb536-2"><a href="the-normal-distribution.html#cb536-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> mom.iq, <span class="at">y =</span> kid.score)) </span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-282-3.png" width="672" /></p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Reading from the color scale, the height of the "peak" in each of the two-dimensional kernel density plots from above was around 0.16. Why is this?</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<p>If <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span> are independent standard normal random variables, then their joint density equals the product of their marginal densities:
<span class="math display">\[
\begin{aligned}
f(z_1, z_2) &amp;= f(z_1) f(z_2) = \frac{1}{\sqrt{2\pi}} \exp\left(-\frac{z_1^2}{2} \right) \times  \frac{1}{\sqrt{2\pi}} \exp\left(-\frac{z_2^2}{2} \right) \\
&amp;=\frac{1}{2 \pi} \exp\left\{-\frac{1}{2} (z_1^2 + z_2^2)\right\}.
\end{aligned}
\]</span>
Since <span class="math inline">\(1/(2\pi)\)</span> is positive and <span class="math inline">\(-1/2\)</span> is negative, this function is maximized when <span class="math inline">\(z_1 + z_2^2\)</span> is made as small as possible, i.e. at <span class="math inline">\((0,0)\)</span>. Substituting these values gives <span class="math inline">\(f(0,0) = 1/(2\pi) \approx 0.159\)</span>.</p>
</div>
<ol start="3" style="list-style-type: decimal">
<li>The contours of equal density for a pair of uncorrelated standard normal variables are circles. Why?</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<p>From the expression in the previous solution, <span class="math inline">\(f(z_1, z_2)\)</span> is constant whenever <span class="math inline">\((z_1^2 + z_2^2)\)</span> is constant, and the expression <span class="math inline">\((z_1^2 + z_2^2) = \text{C}\)</span> describes a circle centered at <span class="math inline">\((0,0)\)</span>.</p>
</div>
</div>
<div id="multiply-by-scalars-to-change-the-variance" class="section level3" number="6.3.5">
<h3><span class="header-section-number">6.3.5</span> Multiply by Scalars to Change the Variance</h3>
<p>Shifting the means of two random variables by adding a constant to each has no effect on their respective variances or covariances. If <span class="math inline">\(Z_1, Z_2 \sim \text{ iid N}(0,1)\)</span> and <span class="math inline">\(c_1, c_2\)</span> are constants, then
<span class="math display">\[
\begin{aligned}
\text{Var}(Z_1 + c_1) &amp;= \text{Var}(Z_2 + c_2) = \text{Var}(Z_1) = 1\\
\text{Cov}(Z_1 + c_1, Z_2 + c_2) &amp;= \text{Cov}(Z_1, Z_2) = 0
\end{aligned}
\]</span>
For this reason we'll work with zero mean normals throughout most of this lesson. After we've created normal random variables with the desired variances and covariances, we can always shift their means as needed. To change the <em>variances</em> of <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span> without creating any covariance between them, we simply multiply each by a constant. While we won't delve into the details of the geometry, this turns <em>circles</em> of equal density into <em>ellipses</em>. For example:</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="the-normal-distribution.html#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the variances from (1, 1) to (4, 25)</span></span>
<span id="cb537-2"><a href="the-normal-distribution.html#cb537-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">x1 =</span> <span class="dv">2</span> <span class="sc">*</span> z[,<span class="dv">1</span>], <span class="at">x2 =</span> <span class="dv">5</span> <span class="sc">*</span> z[,<span class="dv">2</span>]) </span>
<span id="cb537-3"><a href="the-normal-distribution.html#cb537-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb537-4"><a href="the-normal-distribution.html#cb537-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(x)</span></code></pre></div>
<pre><code>##            x1          x2
## x1 4.02551326  0.00473838
## x2 0.00473838 25.09184630</code></pre>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="the-normal-distribution.html#cb539-1" aria-hidden="true" tabindex="-1"></a>x_marginals <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(x)) <span class="sc">+</span></span>
<span id="cb539-2"><a href="the-normal-distribution.html#cb539-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1), <span class="at">fill =</span> <span class="st">&#39;black&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb539-3"><a href="the-normal-distribution.html#cb539-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> x2), <span class="at">fill =</span> <span class="st">&#39;orange&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb539-4"><a href="the-normal-distribution.html#cb539-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;&#39;</span>)</span>
<span id="cb539-5"><a href="the-normal-distribution.html#cb539-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-6"><a href="the-normal-distribution.html#cb539-6" aria-hidden="true" tabindex="-1"></a>x_joint <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(x)) <span class="sc">+</span></span>
<span id="cb539-7"><a href="the-normal-distribution.html#cb539-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2)) <span class="sc">+</span></span>
<span id="cb539-8"><a href="the-normal-distribution.html#cb539-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()  <span class="co"># forces the aspect ratio to be 1:1 so you see the ellipses!</span></span>
<span id="cb539-9"><a href="the-normal-distribution.html#cb539-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-10"><a href="the-normal-distribution.html#cb539-10" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(x_marginals, x_joint, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-283-1.png" width="672" /></p>
</div>
<div id="combine-to-create-correlation" class="section level3" number="6.3.6">
<h3><span class="header-section-number">6.3.6</span> Combine to Create Correlation</h3>
<p>There's one more fact about normal distributions that we'll need: <strong>a sum of independent normal random variables is itself a normal random variable.</strong> For our purposes, this means that <span class="math inline">\(X \equiv a Z_1 + b Z_2 + c\)</span> is a normal random variable for any constants <span class="math inline">\(a, b\)</span>, and <span class="math inline">\(c\)</span>.<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a> Its mean and variance are determined from the values of <span class="math inline">\(a, b\)</span>, and <span class="math inline">\(c\)</span>.</p>
<p>Now we're ready to construct some correlated normals. Suppose I define <span class="math inline">\(X_1 \equiv 2 Z_1 + Z_2\)</span> and <span class="math inline">\(X_2 \equiv Z_1 + 4 Z_2\)</span>. In other words, suppose that I <em>combine</em> <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span> in two different ways by taking two distinct linear combinations. Because <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> depend on the same underlying standard normal random variables <span class="math inline">\((Z_1, Z_2)\)</span> we would expect them to be correlated, and indeed they are:</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="the-normal-distribution.html#cb540-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">x1 =</span> <span class="dv">2</span> <span class="sc">*</span> z[,<span class="dv">1</span>] <span class="sc">+</span> z[,<span class="dv">2</span>],</span>
<span id="cb540-2"><a href="the-normal-distribution.html#cb540-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">x2 =</span> z[,<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> z[,<span class="dv">2</span>])</span>
<span id="cb540-3"><a href="the-normal-distribution.html#cb540-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(x)</span></code></pre></div>
<pre><code>##          x1        x2
## x1 5.031082  6.031717
## x2 6.031717 17.068951</code></pre>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="the-normal-distribution.html#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x)</span></code></pre></div>
<pre><code>##           x1        x2
## x1 1.0000000 0.6508888
## x2 0.6508888 1.0000000</code></pre>
<p>An equivalent, but slightly nicer way of constructing <code>x</code> uses matrix multiplication. Written in matrix from, the two linear combinations from above can be expressed as <span class="math inline">\(\mathbf{X} = \mathbf{A} \mathbf{Z}\)</span> where
<span class="math display">\[
\mathbf{X} = \begin{bmatrix} X_1 \\ X_2 \end{bmatrix}, \quad  \mathbf{Z} = \begin{bmatrix} Z_1 \\ Z_2\end{bmatrix}, \quad \mathbf{A} \equiv \begin{bmatrix} 2 &amp; 1 \\ 1 &amp; 4\end{bmatrix}.
\]</span>
To implement this in R, we need to introduce a few new commands. First, <code>matrix()</code> is used to convert a vector of values into a matrix:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="the-normal-distribution.html#cb544-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, </span>
<span id="cb544-2"><a href="the-normal-distribution.html#cb544-2" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>, <span class="dv">4</span>), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb544-3"><a href="the-normal-distribution.html#cb544-3" aria-hidden="true" tabindex="-1"></a>A</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    2    1
## [2,]    1    4</code></pre>
<p>The first argument of <code>matrix()</code> is the vector of values that we will use to fill our matrix; <code>ncol</code> and <code>nrow</code> are the desired numbers of columns and rows. By default, R fills matrices <em>by column</em>. To make things easier to read, I've added line breaks so you can "see" the matrix and set the argument <code>byrow = TRUE</code> so that R will fill <code>A</code> by row instead.</p>
<p>Next we need to multiply <span class="math inline">\((Z_1, Z_2)&#39;\)</span> by <span class="math inline">\(\mathbf{A}\)</span>. Each <em>row</em> of the matrix <code>z</code> contains one simulated realization of <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span>, but our expression <span class="math inline">\(\mathbf{X} = \mathbf{A}\mathbf{Z}\)</span> from above represents <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span> as a <em>column</em> rather than a row. This means we'll need to transpose them using the <code>t()</code> function. Here's an example of <code>t()</code> in action:</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="the-normal-distribution.html#cb546-1" aria-hidden="true" tabindex="-1"></a>A</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    2    1
## [2,]    1    4</code></pre>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="the-normal-distribution.html#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(A)</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    2    1
## [2,]    1    4</code></pre>
<p>Finally, we need to know how to multiply matrices in R. There are <em>two</em> notions of a "matrix product" in R. The first is <em>elementwise</em> multiplication: <code>A * B</code> multiplies every element of <code>A</code> by the corresponding element of <code>B</code> for example</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="the-normal-distribution.html#cb550-1" aria-hidden="true" tabindex="-1"></a>A <span class="sc">*</span> A</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    4    1
## [2,]    1   16</code></pre>
<p>The second, and the one we need here, is <em>matrix multiplication</em>: <code>A %*% B</code> creates a matrix whose <code>[i,j]</code> element is the dot product of <code>A[i,]</code> with <code>B[,j]</code>. This is the "usual" matrix product that you know and love from linear algebra, for example:</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="the-normal-distribution.html#cb552-1" aria-hidden="true" tabindex="-1"></a>A <span class="sc">%*%</span> A</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    5    6
## [2,]    6   17</code></pre>
<p>Putting the pieces together gives a slicker way to construct the matrix <code>x</code> from above, namely <code>t(A %*% t(z))</code>:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="the-normal-distribution.html#cb554-1" aria-hidden="true" tabindex="-1"></a>x_alt <span class="ot">&lt;-</span> <span class="fu">t</span>(A <span class="sc">%*%</span> <span class="fu">t</span>(z))</span>
<span id="cb554-2"><a href="the-normal-distribution.html#cb554-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x_alt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;x1&#39;</span>, <span class="st">&#39;x2&#39;</span>) <span class="co"># give x_alt the same column names as x</span></span>
<span id="cb554-3"><a href="the-normal-distribution.html#cb554-3" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(x, x_alt) <span class="co"># identical() is picky: it checks names as well as values!</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Because each of them is a sum of independent normals, both <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> are <em>themselves</em> normal random variables. They are both <em>marginally</em> normal and <em>jointly</em> normal:</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="the-normal-distribution.html#cb556-1" aria-hidden="true" tabindex="-1"></a>x_marginals <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(x)) <span class="sc">+</span></span>
<span id="cb556-2"><a href="the-normal-distribution.html#cb556-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(x1), <span class="at">fill =</span> <span class="st">&#39;black&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb556-3"><a href="the-normal-distribution.html#cb556-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(x2), <span class="at">fill =</span> <span class="st">&#39;orange&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb556-4"><a href="the-normal-distribution.html#cb556-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb556-5"><a href="the-normal-distribution.html#cb556-5" aria-hidden="true" tabindex="-1"></a>x_joint <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(x)) <span class="sc">+</span></span>
<span id="cb556-6"><a href="the-normal-distribution.html#cb556-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d_filled</span>(<span class="fu">aes</span>(x1, x2)) <span class="sc">+</span></span>
<span id="cb556-7"><a href="the-normal-distribution.html#cb556-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()  <span class="co"># forces the aspect ratio to be 1:1 so you see the ellipses!</span></span>
<span id="cb556-8"><a href="the-normal-distribution.html#cb556-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb556-9"><a href="the-normal-distribution.html#cb556-9" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(x_marginals, x_joint, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-290-1.png" width="672" /></p>
<p>Notice that the correlation between <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> produces a <em>tilted ellipse</em> in the joint density plot. The ellipse slopes upward because <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> are positively correlated. So how can we tell what covariances we'll end up with for a particular choice of <code>A</code>? You'll work out the answer in the following exercise.</p>
</div>
<div id="exercise-33" class="section level3" number="6.3.7">
<h3><span class="header-section-number">6.3.7</span> Exercise</h3>
<p>Suppose that <span class="math inline">\(Z_1, Z_2 \sim \text{ iid N}(0,1)\)</span> and
<span class="math display">\[
\mathbf{X} = \mathbf{A}\mathbf{Z}, \quad \mathbf{X}= \begin{bmatrix} X_1 \\ X_2 \end{bmatrix}, \quad \mathbf{A} = \begin{bmatrix} a &amp; b \\ c &amp; d\end{bmatrix}, \quad \begin{bmatrix} Z_1 \\ Z_2 \end{bmatrix}.
\]</span>
Calculate the variance of <span class="math inline">\(X_1\)</span>, the variance of <span class="math inline">\(X_2\)</span>, and the covariance between <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> in terms of the constants <span class="math inline">\(a, b, c\)</span>, and <span class="math inline">\(d\)</span>. Using these calculations, show that the variance-covariance matrix of <span class="math inline">\(\mathbf{X}\)</span> equals <span class="math inline">\(\mathbf{A} \mathbf{A}&#39;\)</span>. Use this result to work out the variance-covariance matrix of my example from above with <span class="math inline">\(a = 2, b = 1, c = 1, d = 4\)</span> and check that it agrees with the simulations.</p>
<div class="webex-solution">
<button>
Show Hint
</button>
<p>Don't panic at the sight of the matrix multiplication! It's simply a more compact way of writing the following linear equations:
<span class="math display">\[
\begin{aligned}
X_1 &amp;= a Z_1 + b Z_2 \\
X_2 &amp;= c Z_1 + d Z_2
\end{aligned}
\]</span>
Now use what you know about the properties of variance and covariance, along with the fact that <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span> are independent, to work out the required moments.</p>
</div>
<div class="webex-solution">
<button>
Show Solution
</button>
<p>First we'll calculate the variances. Since <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span> are independent and both have a variance of one,
<span class="math display">\[
\text{Var}(X_1) = \text{Var}(a Z_1 + bZ_2) = a^2 \text{Var}(Z_1) + b^2 \text{Var}(Z_2) = a^2 + b^2
\]</span>
Analogously, <span class="math inline">\(\text{Var}(X_2) = c^2 + d^2\)</span>. Next we'll calculate the covariance. Again, since <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span> are independent,
<span class="math display">\[
\begin{aligned}
\text{Cov}(X_1, X_2) &amp;= \text{Cov}(a Z_1 + b Z_2, \, c Z_1 + d Z_2) \\
&amp;= \text{Cov}(aZ_1, cZ_1) + \text{Cov}(bZ_2, dZ_2)\\
&amp;= ac \,\text{Var}(Z_1) + bd\,\text{Var}(Z_2) \\
&amp;= ac + bd
\end{aligned}
\]</span>
Now we collect these results into a matrix, the variance-covariance matrix of <span class="math inline">\(\mathbf{X}\)</span>:
<span class="math display">\[
\text{Var}(\mathbf{X}) \equiv \begin{bmatrix} \text{Var}(X_1) &amp; \text{Cov}(X_1, X_2) \\ \text{Cov}(X_1, X_2) &amp; \text{Var}(X_2) \end{bmatrix} = 
\begin{bmatrix} a^2 + b^2 &amp; ac + bd \\ ac + bd &amp; c^2 + d^2  \end{bmatrix}
\]</span>
Multiplying through, this is precisely equal to <span class="math inline">\(\mathbf{A}\mathbf{A}&#39;\)</span>
<span class="math display">\[
\mathbf{A}\mathbf{A}&#39; =
\begin{bmatrix} a &amp; b \\ c &amp; d\end{bmatrix}
\begin{bmatrix} a &amp; c \\ b &amp; d\end{bmatrix} = 
\begin{bmatrix}
a^2 + b^2 &amp; ac + bd \\
ac + bd &amp; c^2 + d^2
\end{bmatrix}
\]</span>
Finally, substituting the values from the example above</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="the-normal-distribution.html#cb557-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>,</span>
<span id="cb557-2"><a href="the-normal-distribution.html#cb557-2" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>, <span class="dv">4</span>), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb557-3"><a href="the-normal-distribution.html#cb557-3" aria-hidden="true" tabindex="-1"></a>A <span class="sc">%*%</span> <span class="fu">t</span>(A)</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    5    6
## [2,]    6   17</code></pre>
<p>The sample variance-covariance matrix from our simulations is quite close:</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="the-normal-distribution.html#cb559-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(x)</span></code></pre></div>
<pre><code>##          x1        x2
## x1 5.031082  6.031717
## x2 6.031717 17.068951</code></pre>
</div>
</div>
</div>
<div id="the-cholesky-decomposition" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> The Cholesky Decomposition</h2>
<div style="float:left;position: relative; margin-right: 10px; height: 30%;">
<div class="figure">
<img src="https://upload.wikimedia.org/wikipedia/commons/5/5f/Andre_Cholesky.jpg" alt="" />
<p class="caption">André-Louis Cholesky (1875-1918)</p>
</div>
</div>
<div id="going-backwards" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Going Backwards</h3>
<p>But we <em>still</em> don't know how to produce correlated normal draws! For example, suppose we need to generate two standard normals <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> with <span class="math inline">\(\text{Cor}(X_1, X_2) = 0.5\)</span>. How can we achieve this? In effect, this requires us to work through the preceding exercise <em>in reverse</em>. That is, we need to find constants <span class="math inline">\(a, b, c\)</span>, and <span class="math inline">\(d\)</span> such that<br />
<span class="math display">\[
\begin{aligned}
X_1 &amp;= a Z_1 + b Z_2 \\
X_2 &amp;= c Z_1 + d Z_2
\end{aligned}
\]</span>
gives <span class="math inline">\(\text{Var}(X_1) = \text{Var}(X_2) = 1\)</span> and <span class="math inline">\(\text{Cor}(X_1, X_2) = 0.5\)</span>. There are in fact multiple choices of <span class="math inline">\(a, b, c\)</span>, and <span class="math inline">\(d\)</span> that will do the trick. We'll choose the one that makes our lives the easiest.</p>
<p>Suppose we set <span class="math inline">\(a = 1\)</span> and <span class="math inline">\(b = 0\)</span>, so that <span class="math inline">\(X_1 = Z_1\)</span>. This ensures that <span class="math inline">\(\text{Var}(X_1) = 1\)</span>. Now the question becomes: how can we choose <span class="math inline">\(c\)</span> and <span class="math inline">\(d\)</span> so that the variance of <span class="math inline">\(X_2\)</span> is <em>also</em> one and the correlation between <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> equals 0.5? Using the calculations from the exercise above, <span class="math inline">\(\text{Var}(X_2) = c^2 + d^2\)</span> so we need to set <span class="math inline">\(c^2 + d^2 = 1\)</span>. Solving, this requires <span class="math inline">\(d \pm \sqrt{1 - c^2}\)</span>. Again let's keep things simple and choose the positive solution for <span class="math inline">\(d\)</span>. Using the calculations from the exercise above, <span class="math inline">\(\text{Cov}(X_1, X_2) = ac + bd\)</span> but since we've set <span class="math inline">\(a = 1\)</span> and <span class="math inline">\(b = 0\)</span> this simplifies to <span class="math inline">\(\text{Cov}(X_1, X_2) = c\)</span>. Therefore <span class="math inline">\(c = 0.5\)</span>. Expressed in matrix form, we've shown that
<span class="math display">\[
\begin{bmatrix} 1 &amp; 0 \\ 0.5 &amp; \sqrt{1 - 0.5^2}\end{bmatrix} \begin{bmatrix} Z_1 \\ Z_1 \end{bmatrix} \sim \text{N}\left(\begin{bmatrix}0 \\ 0 \end{bmatrix}, \begin{bmatrix} 1 &amp; 0.5 \\ 0.5 &amp; 1\end{bmatrix} \right).
\]</span>
And this works exactly as expected:</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="the-normal-distribution.html#cb561-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb561-2"><a href="the-normal-distribution.html#cb561-2" aria-hidden="true" tabindex="-1"></a>              <span class="fl">0.5</span>, <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">^</span><span class="dv">2</span>)), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb561-3"><a href="the-normal-distribution.html#cb561-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">t</span>(A <span class="sc">%*%</span> <span class="fu">t</span>(z)) </span>
<span id="cb561-4"><a href="the-normal-distribution.html#cb561-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;x1&#39;</span>, <span class="st">&#39;x2&#39;</span>)</span>
<span id="cb561-5"><a href="the-normal-distribution.html#cb561-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(x)</span></code></pre></div>
<pre><code>##           x1        x2
## x1 1.0063783 0.5035995
## x2 0.5035995 1.0047603</code></pre>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="the-normal-distribution.html#cb563-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(x)) <span class="sc">+</span></span>
<span id="cb563-2"><a href="the-normal-distribution.html#cb563-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d_filled</span>(<span class="fu">aes</span>(x1, x2)) <span class="sc">+</span></span>
<span id="cb563-3"><a href="the-normal-distribution.html#cb563-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()  <span class="co"># forces the aspect ratio to be 1:1 so you see the ellipses!</span></span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-293-1.png" width="672" /></p>
</div>
<div id="exercise-34" class="section level3" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Exercise</h3>
<ol style="list-style-type: decimal">
<li>Suppose we wanted the correlation between <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> to be <span class="math inline">\(\rho\)</span>, a value that might not equal 0.5. Modify the argument from above accordingly.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<p>All we have to do is replace <span class="math inline">\(0.5\)</span> with <span class="math inline">\(\rho\)</span>. Everything else goes through as before, so we obtain
<span class="math display">\[
\begin{bmatrix} 1 &amp; 0 \\ \rho &amp; \sqrt{1 - \rho^2}\end{bmatrix} \begin{bmatrix} Z_1 \\ Z_1 \end{bmatrix} \sim \text{N}\left(\begin{bmatrix}0 \\ 0 \end{bmatrix}, \begin{bmatrix} 1 &amp; \rho \\ \rho &amp; 1\end{bmatrix} \right).
\]</span></p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>In our discussion above, <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> both had variance equal to one, so their correlation equaled their covariance. More generally, we may want to generate <span class="math inline">\(X_1\)</span> with variance <span class="math inline">\(\sigma_1^2\)</span> and <span class="math inline">\(X_2\)</span> with variance <span class="math inline">\(\sigma_2^2\)</span>, where the covariance between them equals <span class="math inline">\(\sigma_{12}\)</span>. Extend your reasoning from the preceding exercise to find an appropriate matrix <span class="math inline">\(\mathbf{A}\)</span> such that <span class="math inline">\(\mathbf{A}\mathbf{Z}\)</span> has the desired variance-covariance matrix.</li>
</ol>
<div class="webex-solution">
<button>
Show Hint
</button>
<p>There are <em>many</em> matrices <span class="math inline">\(\mathbf{A}\)</span> that will do the trick. Following from our reasoning above, construct the one that obeys this convention: the diagonal elements of <span class="math inline">\(\mathbf{A}\)</span> should be positive, and the element above the diagonal should be zero. In other words: <span class="math inline">\(b=0\)</span> and <span class="math inline">\(a, d &gt; 0\)</span>.</p>
</div>
<div class="webex-solution">
<button>
Show Solution
</button>
<p>As above, we just have to work out the appropriate values of the constants <span class="math inline">\(a, b, c\)</span>, and <span class="math inline">\(d\)</span> in the equations <span class="math inline">\(X_1 = a Z_1 + b Z_2\)</span> and <span class="math inline">\(X_2 = c Z_1 + d Z_2\)</span>. Following our convention, <span class="math inline">\(b=0\)</span> so <span class="math inline">\(X_1 = a Z_1\)</span>. Since <span class="math inline">\(Z_1\)</span> is a standard normal, to give <span class="math inline">\(X_1\)</span> a variance of <span class="math inline">\(\sigma_1^2\)</span> we need to set <span class="math inline">\(a = \sigma_1\)</span>. By our convention, this is the <em>positive</em> square root of <span class="math inline">\(\sigma^2_1\)</span> so that <span class="math inline">\(a &gt; 0\)</span>. As we calculated in an earlier exercise,<span class="math inline">\(\text{Cov}(X_1, X_2) = ac + bd\)</span>. Since <span class="math inline">\(a = \sigma_1\)</span> and <span class="math inline">\(b = 0\)</span>, this simplifies to <span class="math inline">\(\text{Cov}(X_1, X_2) = \sigma_1 c\)</span>. In order for this covariance to equal <span class="math inline">\(\sigma_{12}\)</span>, we need to set <span class="math inline">\(c = \sigma_{12}/\sigma_1\)</span>. All that remains is to set the variance of <span class="math inline">\(X_2\)</span> to <span class="math inline">\(\sigma_2^2\)</span>. Again using a calculation from a previous exercise, <span class="math inline">\(\text{Var}(X_2) = c^2 + d^2\)</span>. Substituting our solution for <span class="math inline">\(c\)</span> and equating to <span class="math inline">\(\sigma_2^2\)</span> gives <span class="math inline">\(d^2 = \sigma_2^2 - \sigma_{12}^2/\sigma_1^2\)</span>. To ensure that <span class="math inline">\(d&gt;0\)</span> we set it equal to the positive square root: <span class="math inline">\(d = \sqrt{\sigma_2^2 - \sigma_{12}^2/\sigma_1^2}\)</span>. Collecting our results in matrix form:
<span class="math display">\[
\begin{bmatrix} \sigma_1 &amp; 0 \\ \sigma_{12}/\sigma_1 &amp; \sqrt{\sigma_2^2 - \sigma_{12}^2/\sigma_1^2}\end{bmatrix} \begin{bmatrix} Z_1 \\ Z_1 \end{bmatrix} \sim \text{N}\left(\begin{bmatrix}0 \\ 0 \end{bmatrix}, \begin{bmatrix} \sigma_1^2 &amp; \sigma_{12} \\ \sigma_{12} &amp; \sigma_2^2\end{bmatrix} \right).
\]</span></p>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Check your calculations in the preceding part by transforming the simulations <code>z</code> from above into <code>x</code> such that <code>x1</code> has variance one, <code>x2</code> has variance four, and the correlation between them equals 0.4. Make a density plot of your result.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="the-normal-distribution.html#cb564-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb564-2"><a href="the-normal-distribution.html#cb564-2" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb564-3"><a href="the-normal-distribution.html#cb564-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb564-4"><a href="the-normal-distribution.html#cb564-4" aria-hidden="true" tabindex="-1"></a>s12 <span class="ot">&lt;-</span> r <span class="sc">*</span> (s1 <span class="sc">*</span> s2)</span>
<span id="cb564-5"><a href="the-normal-distribution.html#cb564-5" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(s1, <span class="dv">0</span>,</span>
<span id="cb564-6"><a href="the-normal-distribution.html#cb564-6" aria-hidden="true" tabindex="-1"></a>              s12 <span class="sc">/</span> s1, <span class="fu">sqrt</span>(s2<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> s12<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> s1<span class="sc">^</span><span class="dv">2</span>)), </span>
<span id="cb564-7"><a href="the-normal-distribution.html#cb564-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb564-8"><a href="the-normal-distribution.html#cb564-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">t</span>(A <span class="sc">%*%</span> <span class="fu">t</span>(z)) </span>
<span id="cb564-9"><a href="the-normal-distribution.html#cb564-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;x1&#39;</span>, <span class="st">&#39;x2&#39;</span>)</span>
<span id="cb564-10"><a href="the-normal-distribution.html#cb564-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(x)</span></code></pre></div>
<pre><code>##           x1        x2
## x1 1.0063783 0.8059712
## x2 0.8059712 4.0178160</code></pre>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="the-normal-distribution.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x)</span></code></pre></div>
<pre><code>##           x1        x2
## x1 1.0000000 0.4008149
## x2 0.4008149 1.0000000</code></pre>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="the-normal-distribution.html#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(x)) <span class="sc">+</span></span>
<span id="cb568-2"><a href="the-normal-distribution.html#cb568-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d_filled</span>(<span class="fu">aes</span>(x1, x2)) <span class="sc">+</span></span>
<span id="cb568-3"><a href="the-normal-distribution.html#cb568-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()  <span class="co"># forces the aspect ratio to be 1:1 so you see the ellipses!</span></span></code></pre></div>
<p><img src="erm-book_files/figure-html/unnamed-chunk-294-1.png" width="672" /></p>
</div>
</div>
<div id="whats-the-square-root-of-a-matrix" class="section level3" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> What's the Square Root of a Matrix?</h3>
<p>In the preceding exercise, you found a way to take a <span class="math inline">\((2\times 2)\)</span> covariance matrix <span class="math inline">\(\boldsymbol{\Sigma}\)</span> and <em>decompose</em> it according to <span class="math inline">\(\boldsymbol{\Sigma} = \mathbf{A} \mathbf{A}&#39;\)</span> where <span class="math inline">\(\mathbf{A}\)</span> is a matrix of real numbers. Computing <span class="math inline">\(\mathbf{A}\)</span> is analogous to taking the positive square root of <span class="math inline">\(\sigma^2\)</span>.</p>
<p>There are two important facts about square roots. First, they don't always exist: there's no real number that equals <span class="math inline">\(\sqrt{-4}\)</span>. Second, they're not necessarily unique: both <span class="math inline">\(-2\)</span> and <span class="math inline">\(2\)</span> equal four when squared. So is it always possible to write a variance-covariance matrix in the form <span class="math inline">\(\mathbf{A}\mathbf{A}&#39;\)</span>? The answer turns out to be <em>yes</em>.</p>
<p>Variance-covariance matrices are symmetric, but not every symmetric matrix is a variance-covariance matrix. Here's an example:
<span class="math display">\[
\begin{bmatrix}
4 &amp; 16 \\
16 &amp; 9
\end{bmatrix}
\]</span>
This can't be a variance-covariance matrix. Why not? Taking its correlation matrix gives</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="the-normal-distribution.html#cb569-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">16</span>, </span>
<span id="cb569-2"><a href="the-normal-distribution.html#cb569-2" aria-hidden="true" tabindex="-1"></a>              <span class="dv">16</span>, <span class="dv">9</span>), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb569-3"><a href="the-normal-distribution.html#cb569-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cov2cor</span>(M)</span></code></pre></div>
<pre><code>##          [,1]     [,2]
## [1,] 1.000000 2.666667
## [2,] 2.666667 1.000000</code></pre>
<p>and correlations definitely shouldn't be larger than one! In the same way that variances must be positive, variance-covariance matrices must be <em>positive definite</em>. A symmetric matrix <span class="math inline">\(\mathbf{M}\)</span> is called <em>positive definite</em> if <span class="math inline">\(\mathbf{v}&#39; \mathbf{M} \mathbf{v}&gt;0\)</span> for any vector <span class="math inline">\(\mathbf{v} \neq \mathbf{0}\)</span>. This definition is effectively the matrix equivalent of a positive number.</p>
<p>To see why the definition of positive definiteness makes sense, suppose that <span class="math inline">\(\mathbf{X} \sim \text{N}(\mathbf{0}, \boldsymbol{\Sigma})\)</span> where
<span class="math display">\[
\mathbf{X} = \begin{bmatrix} X_1 \\ X_2 \end{bmatrix}, \quad
\boldsymbol{\Sigma} = \begin{bmatrix} \sigma_1^2 &amp; \sigma_{12} \\
\sigma_{12} &amp; \sigma_2^2\end{bmatrix}
\]</span>
as in the exercise above. Now define <span class="math inline">\(Y = \alpha X_1 + \beta X_2\)</span>. Unless <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are <em>both</em> zero, <span class="math inline">\(Y\)</span> is a normal random variable so it certainly must have a positive variance. If we define <span class="math inline">\(\mathbf{v}&#39; = \begin{bmatrix} \alpha &amp; \beta \end{bmatrix}\)</span> then, a bit of algebra shows that <span class="math inline">\(\text{Var}(Y) = \mathbf{v}&#39; \boldsymbol{\Sigma} \mathbf{v}\)</span>. (See the exercise below.) So requiring that <span class="math inline">\(\mathbf{v} \boldsymbol{\Sigma} \mathbf{v}&#39; &gt; 0\)</span> is <em>equivalent</em> to requiring that any random variable <span class="math inline">\(Y\)</span> that we form by taking a linear combination of <span class="math inline">\(\mathbf{X}\)</span> has a positive variance. There's nothing special about the two-dimensional case: this all applies in general. This is why a matrix that isn't positive definite can't be a variance-covariance matrix.<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a></p>
<p>Fortunately for anyone who wants to generate correlated normal draws, <em>any</em> positive definite matrix <span class="math inline">\(\boldsymbol{\Sigma}\)</span>, has a "square root" in the sense that it can be written as <span class="math inline">\(\boldsymbol{\Sigma} = \mathbf{A}\mathbf{A}&#39;\)</span>. But just as the square root of a real number isn't unique, <span class="math inline">\(\mathbf{A}\)</span> likewise isn't unique. For example,
<span class="math display">\[
\begin{bmatrix}
1 &amp; 0.5 \\ 0.5 &amp; 1
\end{bmatrix} = \mathbf{A}\mathbf{A}&#39;= \mathbf{B}\mathbf{B}&#39;,  \quad
\mathbf{A} = \begin{bmatrix}
1 &amp; 0 \\ 1/2 &amp; \sqrt{3}/2
\end{bmatrix},
\quad 
\mathbf{B} =
\begin{bmatrix}
\frac{1}{\sqrt{2}} &amp; \frac{1}{\sqrt{2}} \\
\frac{\sqrt{2} - \sqrt{6}}{4} &amp; \frac{\sqrt{2} + \sqrt{6}}{4}
\end{bmatrix}
\]</span>
Adopting the convention that <span class="math inline">\(\mathbf{A}\)</span> should be <a href="https://en.wikipedia.org/wiki/Triangular_matrix"><em>lower triangular</em></a> and that its diagonal elements should all be positive, however, <em>does</em> uniquely pin down <span class="math inline">\(\mathbf{A}\)</span>: it picks out the first of these alternatives. This <span class="math inline">\((2\times 2)\)</span> example is a special case of the so-called <a href="https://en.wikipedia.org/wiki/Cholesky_decomposition">Cholesky Decomposition</a>: any positive definite matrix <span class="math inline">\(\Sigma\)</span> can be expressed as <span class="math inline">\(\Sigma = \mathbf{L}\mathbf{L}&#39;\)</span> where <span class="math inline">\(\mathbf{L}\)</span> is a lower triangular matrix with positive diagonal elements. The R command for the Cholesky decomposition is <code>chol()</code>. <strong>Just to make life confusing</strong>, <code>chol()</code> returns <span class="math inline">\(\mathbf{L}&#39;\)</span> rather than <span class="math inline">\(\mathbf{L}\)</span>,</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="the-normal-distribution.html#cb571-1" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>,</span>
<span id="cb571-2"><a href="the-normal-distribution.html#cb571-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb571-3"><a href="the-normal-distribution.html#cb571-3" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb571-4"><a href="the-normal-distribution.html#cb571-4" aria-hidden="true" tabindex="-1"></a>              <span class="fl">0.5</span>, <span class="fu">sqrt</span>(<span class="dv">3</span>)<span class="sc">/</span><span class="dv">2</span>), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb571-5"><a href="the-normal-distribution.html#cb571-5" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">t</span>(A), <span class="fu">chol</span>(Sigma))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Here's how to remember this quirk: <em>true to its name</em> R returns an <em>upper</em> triangular matrix <span class="math inline">\(\mathbf{R}\)</span>, so its version of Cholesky is <span class="math inline">\(\boldsymbol{\Sigma} = \mathbf{R} \mathbf{R}&#39;\)</span>. Armed with this knowledge, we can now generate <em>more than two</em> correlated normal random variables, as you'll discover in the following exercise.</p>
</div>
<div id="exercise-35" class="section level3" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> Exercise</h3>
<ol style="list-style-type: decimal">
<li>Suppose that <code>M</code> is a <span class="math inline">\((3 \times 3)\)</span> matrix. Here's how to check if it's positive definite. First check <code>M[1,1]</code>; this element needs to be positive. Next check the <span class="math inline">\((2\times 2)\)</span> sub-matrix <code>M[1:2,1:2]</code>; its <em>determinant</em>, which you can calculate using <code>det()</code> needs to be positive. Finally check the determinant of <code>M</code> itself; this too needs to be positive. If <code>M</code> passes all the tests then it's positive definite! The same procedure works for smaller matrices and larger ones: we check that the determinant of each <a href="https://en.wikipedia.org/wiki/Minor_(linear_algebra)"><em>leading principal minor</em></a> is positive. Here are two matrices, one of which is positive definite and one of which is not. Determine which is which.
<span class="math display">\[
\begin{bmatrix}
? &amp; ? \\
? &amp; ? 
\end{bmatrix}, \quad
\begin{bmatrix}
? &amp; ? \\
? &amp; ?
\end{bmatrix}
\]</span></li>
<li>Use the positive definite matrix from the preceding exercise, along with the R function <code>chol()</code>, to make 100,000 draws from the corresponding 3-dimensional multivariate normal distribution. Use <code>cov()</code> to check your work.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="the-normal-distribution.html#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add solution code here!</span></span></code></pre></div>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Install the package <code>mvtnorm()</code> and read the help file for <code>rmvnorm()</code>. This this function to repeat the preceding exercise "the easy way." Again, check your work using <code>cov()</code>.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="the-normal-distribution.html#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add solution code here!</span></span></code></pre></div>
</div>
<ol start="4" style="list-style-type: decimal">
<li>In the discussion above I claimed that <span class="math inline">\(\text{Var}(Y) = \mathbf{v}&#39;\boldsymbol{\Sigma}\text{v}\)</span>. Work out the algebra to establish this result.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<p><span class="math display">\[
\begin{aligned}
\mathbf{v}&#39; \boldsymbol{\Sigma} \mathbf{v} &amp;= \begin{bmatrix} \alpha &amp; \beta \end{bmatrix} \begin{bmatrix} \sigma_1^2 &amp; \sigma_{12} \\ \sigma_{12} &amp; \sigma_2^2\end{bmatrix} \begin{bmatrix} \alpha \\ \beta \end{bmatrix}\\
&amp;= \alpha^2 \text{Var}(X_1) + 2\alpha \beta\, \text{Cov}(X_1, X_2) + \beta^2 \text{Var}(X_2) \\
&amp;= \text{Var}(\alpha X_1 + \beta X_2) = \text{Var}(Y).
\end{aligned}
\]</span></p>
</div>
</div>
</div>
<div id="epilogue" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Epilogue</h2>
<p>So why did I pack all of this matrix algebra into a book that is ostensibly about empirical research methods? There are several reasons. First, you will one day encounter an error in your code telling you that a certain matrix is <code>not positive definite!</code> You need to understand what this means and why it's important. Second, the Cholesky decomposition comes up all over the place in applied econometrics and statistics. Now that you understand <em>how to build it up from scratch</em> in the <span class="math inline">\((2\times 2)\)</span> case, I hope you will find the general idea intuitive rather than mystifying when you next encounter it. Third, and most importantly, the approach of building up everything from scratch by combining Cholesky with independent standard normals pays big dividends in helping you understand the multivariate normal distribution. To show you what I mean, here are two important facts that you can now deduce <em>effectively for free</em> from what you've worked out above.</p>
<div id="affine-transformations-of-a-multivariate-normal" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Affine Transformations of a Multivariate Normal</h3>
<p>You worked out the two-dimensional case above, but the same holds in <span class="math inline">\(p\)</span> dimensions: if <span class="math inline">\(\mathbf{Z}\)</span> is a <span class="math inline">\(p\)</span>-dimensional vector of standard normal random variables, <span class="math inline">\(\mathbf{A}\)</span> is a <span class="math inline">\((p\times p)\)</span> matrix of constants and <span class="math inline">\(\boldsymbol{\mu}\)</span> is a <span class="math inline">\(p\)</span>-dimensional vector of constants, then <span class="math inline">\(\mathbf{X} \equiv \boldsymbol{\mu} + \mathbf{A} \mathbf{Z}\)</span> is a multivariate normal random vector with mean vector <span class="math inline">\(\boldsymbol{\mu}\)</span> and variance-covariance matrix <span class="math inline">\(\boldsymbol{\Sigma} = \mathbf{A}\mathbf{A}&#39;\)</span>.</p>
<p>The shifting and scaling operation that we use to go from <span class="math inline">\(\mathbf{Z}\)</span> to <span class="math inline">\(\mathbf{X}\)</span> has a name: it's called an <a href="https://en.wikipedia.org/wiki/Affine_transformation">affine transformation</a>. So what happens if we apply an affine transformation to <span class="math inline">\(\mathbf{X}\)</span>? Suppose that <span class="math inline">\(\mathbf{Y} = \mathbf{c} + \mathbf{B} \mathbf{X}\)</span> where <span class="math inline">\(\mathbf{c}\)</span> and <span class="math inline">\(\mathbf{B}\)</span> are constant. What is the distribution of <span class="math inline">\(\mathbf{Y}\)</span>? This turns out to be a <a href="https://en.wikipedia.org/wiki/Lagniappe">free extra</a>. Writing <span class="math inline">\(\mathbf{X}\)</span> in terms of <span class="math inline">\(\mathbf{Z}\)</span> reveals that <span class="math inline">\(\mathbf{Y}\)</span> is <em>itself</em> an affine transformation of <span class="math inline">\(\mathbf{Y}\)</span>:
<span class="math display">\[
Y \equiv \mathbf{c} + \mathbf{B} \mathbf{X} = \mathbf{c} + \mathbf{B} (\boldsymbol{\mu} + \mathbf{A} \mathbf{Z}) = (\mathbf{c} + \mathbf{B} \boldsymbol{\mu}) + (\mathbf{B}\mathbf{A}) \mathbf{Z}
\]</span>
Now we can simply apply our result from above with <span class="math inline">\(\mathbf{c} + \mathbf{B} \boldsymbol{\mu}\)</span> as the "shift vector" and <span class="math inline">\(\mathbf{B}\mathbf{A}\)</span> as the "scaling matrix." It follows that <span class="math inline">\(\mathbf{Y}\)</span> is a multivariate normal with mean <span class="math inline">\(\mathbf{c} + \mathbf{B} \boldsymbol{\mu}\)</span> and variance-covariance matrix equal to
<span class="math display">\[
(\mathbf{B} \mathbf{A})(\mathbf{B} \mathbf{A})&#39; = \mathbf{B}\mathbf{A} \mathbf{A}&#39; \mathbf{B}&#39;.
\]</span>
Since the transpose of a product equals the product of the transposes <a href="https://math.stackexchange.com/a/1280243"><em>in the reverse order</em></a>. In other words, <strong>affine transformations of normals are always normal.</strong></p>
</div>
<div id="conditional-distributions-of-bivariate-normal" class="section level3" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Conditional Distributions of Bivariate Normal</h3>
<p>Suppose that <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> are jointly normal with mean vector <span class="math inline">\(\boldsymbol{\mu}\)</span> and variance-covariance matrix <span class="math inline">\(\boldsymbol{Sigma}\)</span>. What is the <em>conditional</em> distribution of <span class="math inline">\(X_2\)</span> given <span class="math inline">\(X_1\)</span>? There's a <a href="https://en.wikipedia.org/wiki/Multivariate_normal_distribution#Conditional_distributions">formula you could memorize</a>, but if you're anything like me you'll forget this when you need it the most. Instead, let's use Cholesky to help us.</p>
<p>If <span class="math inline">\(\boldsymbol{\Sigma}\)</span> is positive definite, then we can construct <span class="math inline">\(\mathbf{A}\)</span> such that
<span class="math display">\[
\begin{bmatrix}
X_1 \\ X_2
\end{bmatrix} = 
\begin{bmatrix}
\mu_1 \\ \mu_2
\end{bmatrix} +
\begin{bmatrix}
a &amp; 0 \\
c &amp; d
\end{bmatrix}
\begin{bmatrix}
Z_1 \\ Z_2
\end{bmatrix}
\]</span>
where <span class="math inline">\(Z_1, Z_2\)</span> are independent standard normals, <span class="math inline">\(\mu_1\)</span> and <span class="math inline">\(\mu_2\)</span> are the means of <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span>, and <span class="math inline">\(a, c, d\)</span> are constants with such that <span class="math inline">\(a, d &gt; 0\)</span>. This implies that <span class="math inline">\(X_1 = \mu_1 + aZ_1\)</span> and <span class="math inline">\(X_2 = \mu_2 + c Z_1 + d Z_2\)</span>. So what does it mean to condition on <span class="math inline">\(X_1 = x\)</span>? Since <span class="math inline">\(a\)</span> and <span class="math inline">\(\mu_1\)</span> are constants, the only <em>randomness</em> in <span class="math inline">\(X_1\)</span> comes from <span class="math inline">\(Z_1\)</span>. Thus, rearranging the expression for <span class="math inline">\(X_1\)</span>, we see that conditioning on <span class="math inline">\(X_1 = x\)</span> is the same thing as conditioning on <span class="math inline">\(Z_1 = (x - \mu_1)/a\)</span>. Substituting this into the expression for <span class="math inline">\(X_2\)</span> gives
<span class="math display">\[
X_2|(X_1 = x) =  \mu_2 + \frac{c}{a} (x - \mu_1)  + d Z_2.
\]</span>
The only random variable in this expression is <span class="math inline">\(Z_2\)</span>: everything else is a constant. Indeed, conditional on <span class="math inline">\(X_1 = x\)</span> we see that <span class="math inline">\(X_2\)</span> is merely an <em>affine transformation</em> of <span class="math inline">\(Z_2\)</span>, so
<span class="math display">\[
X_2|(X_1 = x) \sim \text{N}\left(\mu_{2|1}, \sigma^2_{2|1} \right), \quad
\mu_{2|1}\equiv \mu_2 + \frac{c}{a}(x - \mu_1), \quad
\sigma^2_{2|1}\equiv d^2
\]</span>
Two things jump out immediately. First, the conditional mean of <span class="math inline">\(X_1\)</span> depends <em>linearly</em> on <span class="math inline">\(x\)</span>, the value that <span class="math inline">\(X_1\)</span> takes on. Second, the conditional variance of <span class="math inline">\(X_2\)</span> <em>does not</em> depend on <span class="math inline">\(x\)</span>. Substituting the values for <span class="math inline">\(a\)</span> and <span class="math inline">\(c\)</span> that you worked out in the exercise above we see that <span class="math inline">\(a/c = \sigma_{12}/\sigma_1^2\)</span>. This is the <em>slope of the regression line</em> from a population linear regression of <span class="math inline">\(X_2\)</span> on <span class="math inline">\(X_1\)</span>, call it <span class="math inline">\(\beta\)</span>. Substituting into the expression for <span class="math inline">\(\mu_{1|2}\)</span> gives
<span class="math display">\[
\begin{aligned}
\mu_{2|1} &amp;= \left[\mu_2 - \left(\frac{\sigma_{12}}{\sigma_1^2}\right)\mu_1\right] + \left( \frac{\sigma_{12}}{\sigma_1^2}\right) x \\
&amp;= \left[E(X_2) - \beta E(X_1)\right] + \beta x\\
&amp;= \alpha + \beta x
\end{aligned}
\]</span>
where we recognize <span class="math inline">\(\alpha\)</span> as the <em>intercept</em> of the population regression line. Similarly, substituting the value for <span class="math inline">\(d^2\)</span> that you worked out in the exercises above, we obtain
<span class="math display">\[
\begin{aligned}
\sigma^2_{2|1} &amp;= \sigma_2^2 - \frac{\sigma_{12}^2}{\sigma_1^2} = \sigma_2^2\left( 1 - \frac{\sigma_{12}^2}{\sigma_1^2 \sigma_2^2}\right) = \sigma_2^2 (1 - \rho_{12}^2).
\end{aligned}
\]</span>
And what is <span class="math inline">\(\rho_{12}^2\)</span>? It's the <em>R-squared</em> for the population linear regression of <span class="math inline">\(X_2\)</span> on <span class="math inline">\(X_1\)</span>! Linear regression is intrinsically related to the properties of multivariate normal distributions, giving you yet another way of remembering this useful result!</p>
</div>
</div>
<div id="problem-set" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Problem Set</h2>
<ol style="list-style-type: decimal">
<li>Write an R function called <code>rbinorm()</code> to generate bivariate normal draws. Arguments <code>mean</code> is a vector of length 2, <code>var</code> is a <span class="math inline">\((2\times 2)\)</span> matrix. Don't use <code>chol()</code> do everything from scratch. Check that the matrix is pd before running: <code>stopifnot()</code>. Test it out on these example matrices: use <code>cov()</code> with <code>n</code> draws.</li>
<li>Work out the details for <span class="math inline">\((3 \times 3)\)</span> cholesky. <strong>Hint:</strong> start with the <span class="math inline">\((2\times 2)\)</span> case. This will be the upper <span class="math inline">\((2\times 2)\)</span> matrix. All you have to do is work out the bottom row of <span class="math inline">\(\mathbf{L}\)</span>. Write an R function to calculate Cholesky of a <span class="math inline">\((3\times 3)\)</span> matrix. Test is on <em>this example</em> and compare to <code>chol()</code>.</li>
</ol>

</div>
</div>




























<div class="footnotes">
<hr />
<ol start="21">
<li id="fn21"><p>Okay, fine: if <span class="math inline">\(a = b = 0\)</span> then <span class="math inline">\(X\)</span> merely equals the constant <span class="math inline">\(c\)</span>. But in any other case, <span class="math inline">\(X\)</span> is normally distributed.<a href="the-normal-distribution.html#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p>Strictly speaking a variance-covariance matrix only needs to be positive <em>semi-definite</em>, i.e. <span class="math inline">\(\mathbf{v}&#39; \boldsymbol{\Sigma} \mathbf{v}\geq 0\)</span> for any <span class="math inline">\(\mathbf{v} \neq \mathbf{0}\)</span>. But if there's a non-zero vector <span class="math inline">\(\mathbf{v}\)</span> such that <span class="math inline">\(\mathbf{v} \boldsymbol{\Sigma} \mathbf{v} = \mathbf{0}\)</span> this means that one of the random variables contained in <span class="math inline">\(\mathbf{X}\)</span> is <em>redundant</em> in that it is perfectly correlated with some linear combination of the others. Such a variance-covariance matrix gives rise to what is called a <em>singular</em> normal distribution. These do come up from time to time, but discussing them further here would take us too far afield. There's already more than enough matrix algebra in this lesson!<a href="the-normal-distribution.html#fnref22" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="predictive-regression-part-ii.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
