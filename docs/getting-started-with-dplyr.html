<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lesson 2 Getting Started with dplyr | Empirical Research Methods</title>
  <meta name="description" content="Lesson 2 Getting Started with dplyr | Empirical Research Methods" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Lesson 2 Getting Started with dplyr | Empirical Research Methods" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lesson 2 Getting Started with dplyr | Empirical Research Methods" />
  
  
  

<meta name="author" content="Francis J. DiTraglia" />


<meta name="date" content="2022-04-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-hot-hand.html"/>
<link rel="next" href="getting-started-with-ggplot2.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="images/core-erm-logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About This Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-requisites"><i class="fa fa-check"></i>Pre-requisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-not-stata"><i class="fa fa-check"></i>Why not Stata?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-not-matlab-julia-or-python"><i class="fa fa-check"></i>Why not Matlab, Julia, or Python?</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-hot-hand.html"><a href="the-hot-hand.html"><i class="fa fa-check"></i><b>1</b> The Hot Hand</a>
<ul>
<li class="chapter" data-level="1.1" data-path="the-hot-hand.html"><a href="the-hot-hand.html#drawing-random-data-in-r"><i class="fa fa-check"></i><b>1.1</b> Drawing Random Data in R</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="the-hot-hand.html"><a href="the-hot-hand.html#sample"><i class="fa fa-check"></i><b>1.1.1</b> <code>sample()</code></a></li>
<li class="chapter" data-level="1.1.2" data-path="the-hot-hand.html"><a href="the-hot-hand.html#probability-distributions-in-r"><i class="fa fa-check"></i><b>1.1.2</b> Probability Distributions in R</a></li>
<li class="chapter" data-level="1.1.3" data-path="the-hot-hand.html"><a href="the-hot-hand.html#set.seed"><i class="fa fa-check"></i><b>1.1.3</b> <code>set.seed()</code></a></li>
<li class="chapter" data-level="1.1.4" data-path="the-hot-hand.html"><a href="the-hot-hand.html#exercises"><i class="fa fa-check"></i><b>1.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="the-hot-hand.html"><a href="the-hot-hand.html#the-skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>1.2</b> The Skeleton of a Simulation Study</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="the-hot-hand.html"><a href="the-hot-hand.html#a-biased-estimator-of-sigma2"><i class="fa fa-check"></i><b>1.2.1</b> A Biased Estimator of <span class="math inline">\(\sigma^2\)</span></a></li>
<li class="chapter" data-level="1.2.2" data-path="the-hot-hand.html"><a href="the-hot-hand.html#draw_sim_data"><i class="fa fa-check"></i><b>1.2.2</b> <code>draw_sim_data()</code></a></li>
<li class="chapter" data-level="1.2.3" data-path="the-hot-hand.html"><a href="the-hot-hand.html#get_estimate"><i class="fa fa-check"></i><b>1.2.3</b> <code>get_estimate()</code></a></li>
<li class="chapter" data-level="1.2.4" data-path="the-hot-hand.html"><a href="the-hot-hand.html#get_bias"><i class="fa fa-check"></i><b>1.2.4</b> <code>get_bias()</code></a></li>
<li class="chapter" data-level="1.2.5" data-path="the-hot-hand.html"><a href="the-hot-hand.html#running-the-simulation-study"><i class="fa fa-check"></i><b>1.2.5</b> Running the Simulation Study</a></li>
<li class="chapter" data-level="1.2.6" data-path="the-hot-hand.html"><a href="the-hot-hand.html#expand.grid-and-map"><i class="fa fa-check"></i><b>1.2.6</b> <code>expand.grid()</code> and <code>Map()</code></a></li>
<li class="chapter" data-level="1.2.7" data-path="the-hot-hand.html"><a href="the-hot-hand.html#formatting-the-results"><i class="fa fa-check"></i><b>1.2.7</b> Formatting the Results</a></li>
<li class="chapter" data-level="1.2.8" data-path="the-hot-hand.html"><a href="the-hot-hand.html#bonus-parallel-computing-with-mcmap"><i class="fa fa-check"></i><b>1.2.8</b> Bonus: Parallel Computing with <code>mcMap()</code></a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="the-hot-hand.html"><a href="the-hot-hand.html#your-turn-simulating-the-hot-hand"><i class="fa fa-check"></i><b>1.3</b> Your Turn: Simulating the Hot Hand</a></li>
<li class="chapter" data-level="1.4" data-path="the-hot-hand.html"><a href="the-hot-hand.html#further-reading"><i class="fa fa-check"></i><b>1.4</b> Further Reading</a></li>
<li class="chapter" data-level="1.5" data-path="the-hot-hand.html"><a href="the-hot-hand.html#mini-projects"><i class="fa fa-check"></i><b>1.5</b> Mini Projects</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="the-hot-hand.html"><a href="the-hot-hand.html#the-hot-hand-revisited"><i class="fa fa-check"></i><b>1.5.1</b> The Hot Hand Revisited</a></li>
<li class="chapter" data-level="1.5.2" data-path="the-hot-hand.html"><a href="the-hot-hand.html#which-estimator-of-the-variance-is-really-better"><i class="fa fa-check"></i><b>1.5.2</b> Which estimator of the variance is <em>really</em> better?</a></li>
<li class="chapter" data-level="1.5.3" data-path="the-hot-hand.html"><a href="the-hot-hand.html#optimal-stopping"><i class="fa fa-check"></i><b>1.5.3</b> Optimal Stopping</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="the-hot-hand.html"><a href="the-hot-hand.html#draft-material"><i class="fa fa-check"></i><b>1.6</b> DRAFT MATERIAL</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html"><i class="fa fa-check"></i><b>2</b> Getting Started with <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#package-installation"><i class="fa fa-check"></i><b>2.1</b> Package Installation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise"><i class="fa fa-check"></i><b>2.1.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#what-is-a-tibble"><i class="fa fa-check"></i><b>2.2</b> What is a tibble?</a></li>
<li class="chapter" data-level="2.3" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#filter-rows-with-filter"><i class="fa fa-check"></i><b>2.3</b> Filter Rows with <code>filter</code></a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercises-1"><i class="fa fa-check"></i><b>2.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#sort-data-with-arrange"><i class="fa fa-check"></i><b>2.4</b> Sort data with <code>arrange</code></a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercises-2"><i class="fa fa-check"></i><b>2.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#choose-columns-with-select"><i class="fa fa-check"></i><b>2.5</b> Choose columns with <code>select</code></a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-1"><i class="fa fa-check"></i><b>2.5.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#the-summarize-verb"><i class="fa fa-check"></i><b>2.6</b> The <code>summarize</code> verb</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-2"><i class="fa fa-check"></i><b>2.6.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#the-group_by-verb"><i class="fa fa-check"></i><b>2.7</b> The <code>group_by</code> verb</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-3"><i class="fa fa-check"></i><b>2.7.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#understanding-the-pipe"><i class="fa fa-check"></i><b>2.8</b> Understanding the pipe: <code>%&gt;%</code></a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-4"><i class="fa fa-check"></i><b>2.8.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#chaining-commands"><i class="fa fa-check"></i><b>2.9</b> Chaining commands</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-5"><i class="fa fa-check"></i><b>2.9.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#change-an-existing-variable-or-create-a-new-one-with-mutate"><i class="fa fa-check"></i><b>2.10</b> Change an existing variable or create a new one with <code>mutate</code></a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="getting-started-with-dplyr.html"><a href="getting-started-with-dplyr.html#exercise-6"><i class="fa fa-check"></i><b>2.10.1</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html"><i class="fa fa-check"></i><b>3</b> Getting Started with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#a-simple-scatterplot-using-ggplot2"><i class="fa fa-check"></i><b>3.1</b> A simple scatterplot using <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-7"><i class="fa fa-check"></i><b>3.1.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#plotting-on-the-log-scale"><i class="fa fa-check"></i><b>3.2</b> Plotting on the log scale</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-8"><i class="fa fa-check"></i><b>3.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#the-color-and-size-aesthetics"><i class="fa fa-check"></i><b>3.3</b> The color and size aesthetics</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-9"><i class="fa fa-check"></i><b>3.3.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#faceting---plots-for-multiple-subsets"><i class="fa fa-check"></i><b>3.4</b> Faceting - Plots for Multiple Subsets</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-10"><i class="fa fa-check"></i><b>3.4.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#plotting-summarized-data"><i class="fa fa-check"></i><b>3.5</b> Plotting summarized data</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-11"><i class="fa fa-check"></i><b>3.5.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#line-plots"><i class="fa fa-check"></i><b>3.6</b> Line plots</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-12"><i class="fa fa-check"></i><b>3.6.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#bar-plots"><i class="fa fa-check"></i><b>3.7</b> Bar plots</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-13"><i class="fa fa-check"></i><b>3.7.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#dotplots"><i class="fa fa-check"></i><b>3.8</b> Dotplots</a></li>
<li class="chapter" data-level="3.9" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#histograms"><i class="fa fa-check"></i><b>3.9</b> Histograms</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-14"><i class="fa fa-check"></i><b>3.9.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#boxplots"><i class="fa fa-check"></i><b>3.10</b> Boxplots</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="getting-started-with-ggplot2.html"><a href="getting-started-with-ggplot2.html#exercise-15"><i class="fa fa-check"></i><b>3.10.1</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html"><i class="fa fa-check"></i><b>4</b> Predictive Regression Part I</a>
<ul>
<li class="chapter" data-level="4.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-16"><i class="fa fa-check"></i><b>4.1.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#the-least-squares-problem"><i class="fa fa-check"></i><b>4.2</b> The Least Squares Problem</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-17"><i class="fa fa-check"></i><b>4.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#linear-regression-with-lm"><i class="fa fa-check"></i><b>4.3</b> Linear Regression with <code>lm()</code></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-18"><i class="fa fa-check"></i><b>4.3.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#plotting-the-regression-line"><i class="fa fa-check"></i><b>4.4</b> Plotting the Regression Line</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-19"><i class="fa fa-check"></i><b>4.4.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#getting-more-from-lm"><i class="fa fa-check"></i><b>4.5</b> Getting More from <code>lm()</code></a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-20"><i class="fa fa-check"></i><b>4.5.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#summarizing-the-ouput-of-lm"><i class="fa fa-check"></i><b>4.6</b> Summarizing The Ouput of <code>lm()</code></a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-21"><i class="fa fa-check"></i><b>4.6.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#tidying-up-with-broom"><i class="fa fa-check"></i><b>4.7</b> Tidying up with <code>broom</code></a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-22"><i class="fa fa-check"></i><b>4.7.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#dummy-variables-with-lm"><i class="fa fa-check"></i><b>4.8</b> Dummy Variables with <code>lm()</code></a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-23"><i class="fa fa-check"></i><b>4.8.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#fun-with-r-formulas"><i class="fa fa-check"></i><b>4.9</b> Fun with R Formulas</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#everything-else---the-dot-."><i class="fa fa-check"></i><b>4.9.1</b> "Everything Else" - The Dot <code>.</code></a></li>
<li class="chapter" data-level="4.9.2" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#removing-predictors-with--"><i class="fa fa-check"></i><b>4.9.2</b> Removing Predictors with <code>-</code></a></li>
<li class="chapter" data-level="4.9.3" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#the-intercept-1"><i class="fa fa-check"></i><b>4.9.3</b> The Intercept: <code>1</code></a></li>
<li class="chapter" data-level="4.9.4" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-24"><i class="fa fa-check"></i><b>4.9.4</b> Exercise</a></li>
<li class="chapter" data-level="4.9.5" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#transforming-outcomes-and-predictors"><i class="fa fa-check"></i><b>4.9.5</b> Transforming Outcomes and Predictors</a></li>
<li class="chapter" data-level="4.9.6" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#adding-interactions-with-and"><i class="fa fa-check"></i><b>4.9.6</b> Adding Interactions With <code>:</code>, <code>*</code>, and <code>^</code></a></li>
<li class="chapter" data-level="4.9.7" data-path="predictive-regression-part-i.html"><a href="predictive-regression-part-i.html#exercise-25"><i class="fa fa-check"></i><b>4.9.7</b> Exercise</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Empirical Research Methods</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="getting-started-with-dplyr" class="section level1" number="2">
<h1><span class="header-section-number">Lesson 2</span> Getting Started with <code>dplyr</code></h1>
<p>This lesson and the next one will introduce you to some powerful tools for exploratory data analysis, using the <a href="https://cran.r-project.org/web/packages/gapminder/index.html"><code>gapminder</code> dataset</a> as an example. Simple descriptive statistics can be extremely powerful. When you read a newspaper columnist arguing that <span class="math inline">\(X\)</span> is to blame for the massive change in <span class="math inline">\(Y\)</span>, how often do you take a look at the data to see if <span class="math inline">\(Y\)</span> is <em>really changing at all</em>? Or if it's actually changing in the <em>opposite direction</em>? These are easy wins and we should make the most of them, particularly given that <a href="https://upgrader.gapminder.org/">many common misconceptions are <em>predictable</em></a>.</p>
<p>Today we'll focus on basic data manipulation and summary statistics using the <a href="https://dplyr.tidyverse.org/"><code>dplyr</code> package</a>, part of the <a href="https://www.tidyverse.org/">Tidyverse</a> family of R packages. We'll make heavy use of <code>dplyr</code> and other Tidyverse packages throughout these lessons. This lesson will only scratch the surface of <code>dplyr</code>, although we'll also pick up a few more <code>dplyr</code> tricks in later lessons as well. A good resource for learning more is <a href="https://r4ds.had.co.nz/">R for Data Science</a>. The <a href="https://github.com/rstudio/cheatsheets/blob/main/data-transformation.pdf">dplyr cheat sheet</a> is also extremely helpful.</p>
<p>So what is <code>dplyr</code> and why should you use it? There are three popular toolkits for data manipulation in R. The first is so-called "base R." This simply means the built-in commands like <code>subset()</code> and operators like <code>[]</code>, <code>$</code>, and so on. You need to know base R and you'll end up using it frequently, but it's simply not a great tool for complicated data manipulation. If you wrangle your data using base R commands, your code will be complicated, hard to read, and hard to maintain. The two main alternatives are <a href="https://dplyr.tidyverse.org/"><code>dplyr</code></a> and <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html"><code>data.table</code></a>. As you might expect, <a href="https://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly">opinions differ</a> on which of these is the "better" choice. Having used and taught both packages, here's my summary of the pros and cons. The <code>data.table</code> package is <em>extremely fast</em>. If you routinely work with very large datasets (a million rows or more), it's worth learning <code>data.table</code>. But <code>data.table</code> syntax is a bit arcane, and can off-putting to newcomers. The key advantage of <code>dplyr</code> is that it's easy to learn and its syntax is <em>extremely intuitive and easy to read</em>. It also has many helpful features that <code>data.table</code> lacks. Given the importance of replicability and open science, this tips the balance in favor of <code>dplyr</code> for this book.</p>
<div id="package-installation" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Package Installation</h2>
<p>Before we can get started, you'll need to install two packages: <code>dplyr</code>, and <code>gapminder</code>. To do this, you can either click on the "Packages" tab in RStudio or use the command <code>install.packages()</code> at the R console, e.g.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="getting-started-with-dplyr.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&#39;dplyr&#39;</span>)</span>
<span id="cb109-2"><a href="getting-started-with-dplyr.html#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&#39;gapminder&#39;</span>)</span></code></pre></div>
<p>You only need to install a package <em>once</em>, but you need to <em>load</em> it every time you want to use it.
To load a package, use the <code>library()</code> command, e.g.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="getting-started-with-dplyr.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb110-2"><a href="getting-started-with-dplyr.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb110-3"><a href="getting-started-with-dplyr.html#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span></code></pre></div>
<p>Now we're ready to go! I could tell you all about the data contained in <code>gapminder</code>, but an important part of this book is helping you to become self-sufficient. So instead I will leave this as an exercise for the reader!</p>
<div id="exercise" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Exercise</h3>
<p>After loading <code>gapminder</code> enter the command <code>?gapminder</code> in the R console to view the R help file for this dataset. Read the documentation you find there to answer the following questions:</p>
<ol style="list-style-type: decimal">
<li>How many rows and columns does <code>gapminder</code> contain?</li>
<li>What information is contained in each row and column?</li>
<li>What is the source of the data?</li>
</ol>
</div>
</div>
<div id="what-is-a-tibble" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> What is a tibble?</h2>
<p>The <code>dplyr</code> package uses a special operator called the <em>pipe</em>, written <code>%&gt;%</code> to chain together commands called <em>verbs</em> that act on objects called <em>tibbles</em>. This probably sounds complicated, but it's easier that it looks. Over the next few sections we'll slowly unpack the preceding sentence by looking at a number of simple examples. But first things first: what is a tibble? Let's see what happens if we display the <code>gapminder</code> dataset:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="getting-started-with-dplyr.html#cb111-1" aria-hidden="true" tabindex="-1"></a>gapminder</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
## # … with 1,694 more rows</code></pre>
<p>If you're used to working with dataframes in R, this may surprise you. Rather than trying to print all <code>nrow(gapminder)</code> rows on the screen, R helpfully shows us a useful summary of the information contained in <code>gapminder</code>. This is because <code>gapminder</code> is <em>not</em> a dataframe; it's a <em>tibble</em>, often abbreviated <em>tbl</em>. For our purposes, all you really need to know about tibbles is that they are souped up versions of R dataframes that are designed to work seamlessly with <code>dplyr</code>. To learn more see the chapter "Tibbles" in <em>R for Data Science</em>.</p>
</div>
<div id="filter-rows-with-filter" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Filter Rows with <code>filter</code></h2>
<p>We're ready to learn our first <code>dplyr</code> verb: <code>filter</code> selects rows.
Here's an example:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="getting-started-with-dplyr.html#cb113-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb113-2"><a href="getting-started-with-dplyr.html#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>)</span></code></pre></div>
<pre><code>## # A tibble: 142 × 6
##    country     continent  year lifeExp       pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       2007    43.8  31889923      975.
##  2 Albania     Europe     2007    76.4   3600523     5937.
##  3 Algeria     Africa     2007    72.3  33333216     6223.
##  4 Angola      Africa     2007    42.7  12420476     4797.
##  5 Argentina   Americas   2007    75.3  40301927    12779.
##  6 Australia   Oceania    2007    81.2  20434176    34435.
##  7 Austria     Europe     2007    79.8   8199783    36126.
##  8 Bahrain     Asia       2007    75.6    708573    29796.
##  9 Bangladesh  Asia       2007    64.1 150448339     1391.
## 10 Belgium     Europe     2007    79.4  10392226    33693.
## # … with 132 more rows</code></pre>
<p>Compare the results of running this command to what we got when we typed <code>gapminder</code> into the console above.
Rather than displaying the whole dataset, now R is only showing us the 142 rows for which the column <code>year</code> has a value of <code>2007</code>.
So how does this work? The pipe operator <code>%&gt;%</code> "pipes" the tibble <code>gapminder</code> into the function <code>filter()</code>. The argument <code>year == 2007</code> tells <code>filter()</code> that it should find all the rows such that the logical condition <code>year == 2007</code> is <code>TRUE</code>.</p>
<p>Oh no! Have we accidentally deleted all of the other rows of <code>gapminder</code>?
No: we haven't made any changes to <code>gapminder</code> at all.
If you don't believe me try entering <code>gapminder</code> at the console.
All that this command does is <em>display</em> a subset of <code>gapminder</code>.
If we wanted to store the result of running this command, we'd need to assign it to a variable, for example</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="getting-started-with-dplyr.html#cb115-1" aria-hidden="true" tabindex="-1"></a>gapminder2007 <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb115-2"><a href="getting-started-with-dplyr.html#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>)</span>
<span id="cb115-3"><a href="getting-started-with-dplyr.html#cb115-3" aria-hidden="true" tabindex="-1"></a>gapminder2007</span></code></pre></div>
<pre><code>## # A tibble: 142 × 6
##    country     continent  year lifeExp       pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       2007    43.8  31889923      975.
##  2 Albania     Europe     2007    76.4   3600523     5937.
##  3 Algeria     Africa     2007    72.3  33333216     6223.
##  4 Angola      Africa     2007    42.7  12420476     4797.
##  5 Argentina   Americas   2007    75.3  40301927    12779.
##  6 Australia   Oceania    2007    81.2  20434176    34435.
##  7 Austria     Europe     2007    79.8   8199783    36126.
##  8 Bahrain     Asia       2007    75.6    708573    29796.
##  9 Bangladesh  Asia       2007    64.1 150448339     1391.
## 10 Belgium     Europe     2007    79.4  10392226    33693.
## # … with 132 more rows</code></pre>
<p>We can also use <code>filter</code> to subset on two or more variables.
For example, here we display data for the US in 2007:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="getting-started-with-dplyr.html#cb117-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb117-2"><a href="getting-started-with-dplyr.html#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>, country <span class="sc">==</span> <span class="st">&#39;United States&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   country       continent  year lifeExp       pop gdpPercap
##   &lt;fct&gt;         &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
## 1 United States Americas   2007    78.2 301139947    42952.</code></pre>
<p>Notice that I always put a linebreak after the pipe operator <code>%&gt;%</code> in my code examples. This isn't required to make the code run, but it's a good habit. As we start to write longer and more complicated <code>dplyr</code> commands, linebreaks will make it much easier to understand how our code works.</p>
<div id="exercises-1" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>What is the difference between <code>x = 3</code> and <code>x == 3</code> in R?</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<p>The first assigns the value <code>3</code> to the variable <code>x</code>; the second tests whether <code>x</code> is equal to <code>3</code> and returns either <code>TRUE</code> or <code>FALSE</code>.</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Write code that uses <code>filter</code> to choose the subset of <code>gapminder</code> for which <code>year</code> is 2002.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="getting-started-with-dplyr.html#cb119-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2002</span>)</span></code></pre></div>
<pre><code>## # A tibble: 142 × 6
##    country     continent  year lifeExp       pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       2002    42.1  25268405      727.
##  2 Albania     Europe     2002    75.7   3508512     4604.
##  3 Algeria     Africa     2002    71.0  31287142     5288.
##  4 Angola      Africa     2002    41.0  10866106     2773.
##  5 Argentina   Americas   2002    74.3  38331121     8798.
##  6 Australia   Oceania    2002    80.4  19546792    30688.
##  7 Austria     Europe     2002    79.0   8148312    32418.
##  8 Bahrain     Asia       2002    74.8    656397    23404.
##  9 Bangladesh  Asia       2002    62.0 135656790     1136.
## 10 Belgium     Europe     2002    78.3  10311970    30486.
## # … with 132 more rows</code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>When I displayed data for the US in 2007, I put quotes around <code>United States</code> but not around <code>year</code>. Why?</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<p>This is because <code>year</code> contains numeric data while <code>country</code> contains character data, aka string data.</p>
</div>
<ol start="4" style="list-style-type: decimal">
<li>If you instead try to choose the subset with <code>year</code> equal to 2005, something will go wrong. Try it. What happens and why?</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<p>If you go back to the help file for <code>gapminder</code> you'll see that it only contains data for every fifth year. The year 2005 isn't in our dataset so <code>dplyr</code> will display an empty tibble:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="getting-started-with-dplyr.html#cb121-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="getting-started-with-dplyr.html#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2005</span>)</span></code></pre></div>
<pre><code>## # A tibble: 0 × 6
## # … with 6 variables: country &lt;fct&gt;, continent &lt;fct&gt;, year &lt;int&gt;,
## #   lifeExp &lt;dbl&gt;, pop &lt;int&gt;, gdpPercap &lt;dbl&gt;</code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>Write code that stores the data for Asian countries in a tibble called <code>gapminder_asia</code>. Then display this tibble.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="getting-started-with-dplyr.html#cb123-1" aria-hidden="true" tabindex="-1"></a>gapminder_asia <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb123-2"><a href="getting-started-with-dplyr.html#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">&#39;Asia&#39;</span>)</span>
<span id="cb123-3"><a href="getting-started-with-dplyr.html#cb123-3" aria-hidden="true" tabindex="-1"></a>gapminder_asia</span></code></pre></div>
<pre><code>## # A tibble: 396 × 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
## # … with 386 more rows</code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>Which country had the higher life expectancy in 1977: Ireland or Brazil?
Which had the higher GDP per capita?</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="getting-started-with-dplyr.html#cb125-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb125-2"><a href="getting-started-with-dplyr.html#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1977</span>, country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Ireland&#39;</span>, <span class="st">&#39;Brazil&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##   country continent  year lifeExp       pop gdpPercap
##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
## 1 Brazil  Americas   1977    61.5 114313951     6660.
## 2 Ireland Europe     1977    72.0   3271900    11151.</code></pre>
</div>
</div>
</div>
<div id="sort-data-with-arrange" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Sort data with <code>arrange</code></h2>
<p>Suppose we wanted to sort <code>gapminder</code> by <code>gdpPercap</code>.
To do this we can use the <code>arrange</code> command along with the pipe <code>%&gt;%</code> as follows:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="getting-started-with-dplyr.html#cb127-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="getting-started-with-dplyr.html#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(gdpPercap)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 6
##    country          continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;            &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Congo, Dem. Rep. Africa     2002    45.0 55379852      241.
##  2 Congo, Dem. Rep. Africa     2007    46.5 64606759      278.
##  3 Lesotho          Africa     1952    42.1   748747      299.
##  4 Guinea-Bissau    Africa     1952    32.5   580653      300.
##  5 Congo, Dem. Rep. Africa     1997    42.6 47798986      312.
##  6 Eritrea          Africa     1952    35.9  1438760      329.
##  7 Myanmar          Asia       1952    36.3 20092996      331 
##  8 Lesotho          Africa     1957    45.0   813338      336.
##  9 Burundi          Africa     1952    39.0  2445618      339.
## 10 Eritrea          Africa     1957    38.0  1542611      344.
## # … with 1,694 more rows</code></pre>
<p>The logic is very similar to what we saw above for <code>filter</code>. We pipe the tibble <code>gapminder</code> into the function <code>arrange()</code>. The argument <code>gdpPercap</code> tells <code>arrange()</code> that we want to sort by GDP per capita. Note that by default <code>arrange()</code> sorts in <em>ascending order</em>. If we want to sort in <em>descending</em> order, we use the function <code>desc()</code> as follows:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="getting-started-with-dplyr.html#cb129-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(gdpPercap))</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 6
##    country   continent  year lifeExp     pop gdpPercap
##    &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;
##  1 Kuwait    Asia       1957    58.0  212846   113523.
##  2 Kuwait    Asia       1972    67.7  841934   109348.
##  3 Kuwait    Asia       1952    55.6  160000   108382.
##  4 Kuwait    Asia       1962    60.5  358266    95458.
##  5 Kuwait    Asia       1967    64.6  575003    80895.
##  6 Kuwait    Asia       1977    69.3 1140357    59265.
##  7 Norway    Europe     2007    80.2 4627926    49357.
##  8 Kuwait    Asia       2007    77.6 2505559    47307.
##  9 Singapore Asia       2007    80.0 4553009    47143.
## 10 Norway    Europe     2002    79.0 4535591    44684.
## # … with 1,694 more rows</code></pre>
<div id="exercises-2" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>What is the lowest life expectancy in the <code>gapminder</code> dataset? Which country and year does it correspond to?</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="getting-started-with-dplyr.html#cb131-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb131-2"><a href="getting-started-with-dplyr.html#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(lifeExp)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 6
##    country      continent  year lifeExp     pop gdpPercap
##    &lt;fct&gt;        &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;
##  1 Rwanda       Africa     1992    23.6 7290203      737.
##  2 Afghanistan  Asia       1952    28.8 8425333      779.
##  3 Gambia       Africa     1952    30    284320      485.
##  4 Angola       Africa     1952    30.0 4232095     3521.
##  5 Sierra Leone Africa     1952    30.3 2143249      880.
##  6 Afghanistan  Asia       1957    30.3 9240934      821.
##  7 Cambodia     Asia       1977    31.2 6978607      525.
##  8 Mozambique   Africa     1952    31.3 6446316      469.
##  9 Sierra Leone Africa     1957    31.6 2295678     1004.
## 10 Burkina Faso Africa     1952    32.0 4469979      543.
## # … with 1,694 more rows</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>What is the highest life expectancy in the <code>gapminder</code> dataset? Which country and year does it correspond to?</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="getting-started-with-dplyr.html#cb133-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb133-2"><a href="getting-started-with-dplyr.html#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 6
##    country          continent  year lifeExp       pop gdpPercap
##    &lt;fct&gt;            &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1 Japan            Asia       2007    82.6 127467972    31656.
##  2 Hong Kong, China Asia       2007    82.2   6980412    39725.
##  3 Japan            Asia       2002    82   127065841    28605.
##  4 Iceland          Europe     2007    81.8    301931    36181.
##  5 Switzerland      Europe     2007    81.7   7554661    37506.
##  6 Hong Kong, China Asia       2002    81.5   6762476    30209.
##  7 Australia        Oceania    2007    81.2  20434176    34435.
##  8 Spain            Europe     2007    80.9  40448191    28821.
##  9 Sweden           Europe     2007    80.9   9031088    33860.
## 10 Israel           Asia       2007    80.7   6426679    25523.
## # … with 1,694 more rows</code></pre>
</div>
</div>
</div>
<div id="choose-columns-with-select" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Choose columns with <code>select</code></h2>
<p>We use the <code>select</code> verb to choose a subset of columns.
For example, to display only <code>pop</code>, <code>country</code>, and <code>year</code>, we would write</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="getting-started-with-dplyr.html#cb135-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb135-2"><a href="getting-started-with-dplyr.html#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pop, country, year)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 3
##         pop country      year
##       &lt;int&gt; &lt;fct&gt;       &lt;int&gt;
##  1  8425333 Afghanistan  1952
##  2  9240934 Afghanistan  1957
##  3 10267083 Afghanistan  1962
##  4 11537966 Afghanistan  1967
##  5 13079460 Afghanistan  1972
##  6 14880372 Afghanistan  1977
##  7 12881816 Afghanistan  1982
##  8 13867957 Afghanistan  1987
##  9 16317921 Afghanistan  1992
## 10 22227415 Afghanistan  1997
## # … with 1,694 more rows</code></pre>
<p>Now suppose that we wanted to select every column <em>except</em> <code>pop</code>.
Here's one way to do it:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="getting-started-with-dplyr.html#cb137-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb137-2"><a href="getting-started-with-dplyr.html#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, continent, year, lifeExp, gdpPercap)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 5
##    country     continent  year lifeExp gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8      779.
##  2 Afghanistan Asia       1957    30.3      821.
##  3 Afghanistan Asia       1962    32.0      853.
##  4 Afghanistan Asia       1967    34.0      836.
##  5 Afghanistan Asia       1972    36.1      740.
##  6 Afghanistan Asia       1977    38.4      786.
##  7 Afghanistan Asia       1982    39.9      978.
##  8 Afghanistan Asia       1987    40.8      852.
##  9 Afghanistan Asia       1992    41.7      649.
## 10 Afghanistan Asia       1997    41.8      635.
## # … with 1,694 more rows</code></pre>
<p>but that takes a lot of typing! If there were more than a handful of columns in our tibble it would be very difficult to <em>deselect</em> a column in this way.
Fortunately there's a shortcut: use the minus sign</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="getting-started-with-dplyr.html#cb139-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>pop)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 5
##    country     continent  year lifeExp gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8      779.
##  2 Afghanistan Asia       1957    30.3      821.
##  3 Afghanistan Asia       1962    32.0      853.
##  4 Afghanistan Asia       1967    34.0      836.
##  5 Afghanistan Asia       1972    36.1      740.
##  6 Afghanistan Asia       1977    38.4      786.
##  7 Afghanistan Asia       1982    39.9      978.
##  8 Afghanistan Asia       1987    40.8      852.
##  9 Afghanistan Asia       1992    41.7      649.
## 10 Afghanistan Asia       1997    41.8      635.
## # … with 1,694 more rows</code></pre>
<p>Just as we could when <em>selecting</em>, we can <em>deselect</em> multiple columns by separating their names with a comma:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="getting-started-with-dplyr.html#cb141-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>pop, <span class="sc">-</span>year)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 4
##    country     continent lifeExp gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia         28.8      779.
##  2 Afghanistan Asia         30.3      821.
##  3 Afghanistan Asia         32.0      853.
##  4 Afghanistan Asia         34.0      836.
##  5 Afghanistan Asia         36.1      740.
##  6 Afghanistan Asia         38.4      786.
##  7 Afghanistan Asia         39.9      978.
##  8 Afghanistan Asia         40.8      852.
##  9 Afghanistan Asia         41.7      649.
## 10 Afghanistan Asia         41.8      635.
## # … with 1,694 more rows</code></pre>
<p>It's easy to mix up the <code>dplyr</code> verbs <code>select</code> and <code>filter</code>.
Here's a handy mnemonic: <code>filteR</code> filters Rows while <code>seleCt</code> selects Columns.
Suppose we wanted to select only the column <code>pop</code> from <code>gapminder</code>.</p>
<div id="exercise-1" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Exercise</h3>
<ol style="list-style-type: decimal">
<li>Select only the columns <code>year</code>, <code>lifeExp</code>, and <code>country</code> in <code>gapminder</code>.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="getting-started-with-dplyr.html#cb143-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="getting-started-with-dplyr.html#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, lifeExp, country)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 3
##     year lifeExp country    
##    &lt;int&gt;   &lt;dbl&gt; &lt;fct&gt;      
##  1  1952    28.8 Afghanistan
##  2  1957    30.3 Afghanistan
##  3  1962    32.0 Afghanistan
##  4  1967    34.0 Afghanistan
##  5  1972    36.1 Afghanistan
##  6  1977    38.4 Afghanistan
##  7  1982    39.9 Afghanistan
##  8  1987    40.8 Afghanistan
##  9  1992    41.7 Afghanistan
## 10  1997    41.8 Afghanistan
## # … with 1,694 more rows</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Select all the columns <em>except</em> <code>year</code>, <code>lifeExp</code>, and <code>country</code> in <code>gapminder</code>.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="getting-started-with-dplyr.html#cb145-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb145-2"><a href="getting-started-with-dplyr.html#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>year, <span class="sc">-</span>lifeExp, <span class="sc">-</span>country)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 3
##    continent      pop gdpPercap
##    &lt;fct&gt;        &lt;int&gt;     &lt;dbl&gt;
##  1 Asia       8425333      779.
##  2 Asia       9240934      821.
##  3 Asia      10267083      853.
##  4 Asia      11537966      836.
##  5 Asia      13079460      740.
##  6 Asia      14880372      786.
##  7 Asia      12881816      978.
##  8 Asia      13867957      852.
##  9 Asia      16317921      649.
## 10 Asia      22227415      635.
## # … with 1,694 more rows</code></pre>
</div>
</div>
</div>
<div id="the-summarize-verb" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> The <code>summarize</code> verb</h2>
<p>Suppose we want to calculate the sample mean of the column <code>lifeExp</code> in <code>gapminder</code>.
We can do this using the <code>summarize</code> verb as follows:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="getting-started-with-dplyr.html#cb147-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">mean_lifeExp =</span> <span class="fu">mean</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   mean_lifeExp
##          &lt;dbl&gt;
## 1         59.5</code></pre>
<p>Note the syntax: within <code>summarize</code> we have an <em>assignment statement</em>.
In particular, we assign <code>mean(lifeExp)</code> to the variable <code>mean_lifeExp</code>.
The key thing to know about <code>summarize</code> is that it always returns <em>collapses</em> a tibble with many rows into a single row.
When we think about computing a sample mean, this makes sense: we want to summarize the column <code>lifeExp</code> as a single number.
It doesn't actually make much sense to compute the mean of <code>lifeExp</code> because this involves averaging over different countries <em>and</em> different years.
Instead let's compute the mean for a single year: 1952:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="getting-started-with-dplyr.html#cb149-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb149-2"><a href="getting-started-with-dplyr.html#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1952</span>) <span class="sc">%&gt;%</span></span>
<span id="cb149-3"><a href="getting-started-with-dplyr.html#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_lifeExp =</span> <span class="fu">mean</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   mean_lifeExp
##          &lt;dbl&gt;
## 1         49.1</code></pre>
<p>We can use summarize to compute multiple summary statistics for a single variable, the same summary statistic for multiple variables, or both:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="getting-started-with-dplyr.html#cb151-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb151-2"><a href="getting-started-with-dplyr.html#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1952</span>) <span class="sc">%&gt;%</span></span>
<span id="cb151-3"><a href="getting-started-with-dplyr.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_lifeExp =</span> <span class="fu">mean</span>(lifeExp),</span>
<span id="cb151-4"><a href="getting-started-with-dplyr.html#cb151-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_lifeExp =</span> <span class="fu">sd</span>(lifeExp), </span>
<span id="cb151-5"><a href="getting-started-with-dplyr.html#cb151-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   mean_lifeExp sd_lifeExp  mean_pop
##          &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1         49.1       12.2 16950402.</code></pre>
<p>Note that if we <em>don't</em> explicitly use an assignment statement, R will make up names for us based on the commands that we used:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="getting-started-with-dplyr.html#cb153-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb153-2"><a href="getting-started-with-dplyr.html#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1952</span>) <span class="sc">%&gt;%</span></span>
<span id="cb153-3"><a href="getting-started-with-dplyr.html#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">mean</span>(lifeExp), <span class="fu">median</span>(lifeExp), <span class="fu">max</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   `mean(lifeExp)` `median(lifeExp)` `max(lifeExp)`
##             &lt;dbl&gt;             &lt;dbl&gt;          &lt;dbl&gt;
## 1            49.1              45.1           72.7</code></pre>
<div id="exercise-2" class="section level3" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Exercise</h3>
<ol style="list-style-type: decimal">
<li>Use <code>summarize</code> to compute the 75th percentile of life expectancy in 1977.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="getting-started-with-dplyr.html#cb155-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb155-2"><a href="getting-started-with-dplyr.html#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1977</span>) <span class="sc">%&gt;%</span></span>
<span id="cb155-3"><a href="getting-started-with-dplyr.html#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">quantile</span>(lifeExp, <span class="fl">0.75</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   `quantile(lifeExp, 0.75)`
##                       &lt;dbl&gt;
## 1                      70.4</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Use <code>summarize</code> to compute the 75th percentile of life expectancy among Asian countries in 1977.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="getting-started-with-dplyr.html#cb157-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb157-2"><a href="getting-started-with-dplyr.html#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1977</span>, continent <span class="sc">==</span> <span class="st">&#39;Asia&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb157-3"><a href="getting-started-with-dplyr.html#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">quantile</span>(lifeExp, <span class="fl">0.75</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   `quantile(lifeExp, 0.75)`
##                       &lt;dbl&gt;
## 1                      65.9</code></pre>
</div>
</div>
</div>
<div id="the-group_by-verb" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> The <code>group_by</code> verb</h2>
<p>The true power of <code>summarize</code> is its ability to compute grouped summary statistics in combination with another <code>dplyr</code> verb: <code>group_by</code>.
In essence, <code>group_by</code> allows us to tell <code>dplyr</code> that we don't want to work with the whole dataset at once; rather we want to work with particular <em>subsets</em> or groups.
The basic idea is similar to what we've done using <code>filter</code> in the past.
For example, to calculate mean population (in millions) and mean life expectancy in the year 2007, we could use the following code:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="getting-started-with-dplyr.html#cb159-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb159-2"><a href="getting-started-with-dplyr.html#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span></span>
<span id="cb159-3"><a href="getting-started-with-dplyr.html#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">meanPop =</span> <span class="fu">mean</span>(pop) <span class="sc">/</span> <span class="dv">1000000</span>, <span class="at">meanLifeExp =</span> <span class="fu">mean</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   meanPop meanLifeExp
##     &lt;dbl&gt;       &lt;dbl&gt;
## 1    44.0        67.0</code></pre>
<p>Using <code>group_by</code> we could do the same thing for <em>all</em> years in the dataset at once:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="getting-started-with-dplyr.html#cb161-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb161-2"><a href="getting-started-with-dplyr.html#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb161-3"><a href="getting-started-with-dplyr.html#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">meanPop =</span> <span class="fu">mean</span>(pop) <span class="sc">/</span> <span class="dv">1000000</span>, <span class="at">meanLifeExp =</span> <span class="fu">mean</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##     year meanPop meanLifeExp
##    &lt;int&gt;   &lt;dbl&gt;       &lt;dbl&gt;
##  1  1952    17.0        49.1
##  2  1957    18.8        51.5
##  3  1962    20.4        53.6
##  4  1967    22.7        55.7
##  5  1972    25.2        57.6
##  6  1977    27.7        59.6
##  7  1982    30.2        61.5
##  8  1987    33.0        63.2
##  9  1992    36.0        64.2
## 10  1997    38.8        65.0
## 11  2002    41.5        65.7
## 12  2007    44.0        67.0</code></pre>
<p>Notice what has changed in the second code block: we replaced <code>filter(year == 2007)</code> with <code>group_by(year)</code>.
This tells <code>dplyr</code> that, rather than simply restricting attention to data from 2007, we want to form <em>subsets</em> (groups) of the dataset that correspond to the values of the <code>year</code> variable.
Whatever comes after <code>group_by</code> will then be calculated for these subsets.</p>
<p>Here's another example.
Suppose we wanted to calculate mean life expectancy and total population in each <em>continent</em> during the year 2007.
To accomplish this, we can chain together the <code>filter</code>, <code>group_by</code> and <code>summarize</code> verbs as follows:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="getting-started-with-dplyr.html#cb163-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb163-2"><a href="getting-started-with-dplyr.html#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span></span>
<span id="cb163-3"><a href="getting-started-with-dplyr.html#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb163-4"><a href="getting-started-with-dplyr.html#cb163-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">meanPop =</span> <span class="fu">mean</span>(pop) <span class="sc">/</span> <span class="dv">1000000</span>, <span class="at">meanLifeExp =</span> <span class="fu">mean</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   continent meanPop meanLifeExp
##   &lt;fct&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 Africa       17.9        54.8
## 2 Americas     36.0        73.6
## 3 Asia        116.         70.7
## 4 Europe       19.5        77.6
## 5 Oceania      12.3        80.7</code></pre>
<p>We can also use <code>group_by</code> to subset over multiple variables at once.
For example, to calculate mean life expectancy and total population in each continent <em>separately</em> for every year, we can use the following code:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="getting-started-with-dplyr.html#cb165-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb165-2"><a href="getting-started-with-dplyr.html#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, continent) <span class="sc">%&gt;%</span></span>
<span id="cb165-3"><a href="getting-started-with-dplyr.html#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">meanPop =</span> <span class="fu">mean</span>(pop) <span class="sc">/</span> <span class="dv">1000000</span>, <span class="at">meanLifeExp =</span> <span class="fu">mean</span>(lifeExp))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 60 × 4
## # Groups:   year [12]
##     year continent meanPop meanLifeExp
##    &lt;int&gt; &lt;fct&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1  1952 Africa       4.57        39.1
##  2  1952 Americas    13.8         53.3
##  3  1952 Asia        42.3         46.3
##  4  1952 Europe      13.9         64.4
##  5  1952 Oceania      5.34        69.3
##  6  1957 Africa       5.09        41.3
##  7  1957 Americas    15.5         56.0
##  8  1957 Asia        47.4         49.3
##  9  1957 Europe      14.6         66.7
## 10  1957 Oceania      5.97        70.3
## # … with 50 more rows</code></pre>
<div id="exercise-3" class="section level3" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Exercise</h3>
<ol style="list-style-type: decimal">
<li>Why doesn't the following code work as expected?</li>
</ol>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="getting-started-with-dplyr.html#cb168-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb168-2"><a href="getting-started-with-dplyr.html#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">meanLifeExp =</span> <span class="fu">mean</span>(lifeExp)) <span class="sc">%&gt;%</span></span>
<span id="cb168-3"><a href="getting-started-with-dplyr.html#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year)</span></code></pre></div>
<div class="webex-solution">
<button>
Show Solution
</button>
<p>The steps are carried out in the wrong order: we need to form groups <em>first</em> and then calculate our desired summaries.</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Calculate the median GDP per capita in each continent in 1977.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="getting-started-with-dplyr.html#cb169-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb169-2"><a href="getting-started-with-dplyr.html#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1977</span>) <span class="sc">%&gt;%</span></span>
<span id="cb169-3"><a href="getting-started-with-dplyr.html#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb169-4"><a href="getting-started-with-dplyr.html#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medGDPc =</span> <span class="fu">median</span>(gdpPercap))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   continent medGDPc
##   &lt;fct&gt;       &lt;dbl&gt;
## 1 Africa      1400.
## 2 Americas    6281.
## 3 Asia        3195.
## 4 Europe     14226.
## 5 Oceania    17284.</code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Repeat 2. but sort your results in descending order.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="getting-started-with-dplyr.html#cb171-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb171-2"><a href="getting-started-with-dplyr.html#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1977</span>) <span class="sc">%&gt;%</span></span>
<span id="cb171-3"><a href="getting-started-with-dplyr.html#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb171-4"><a href="getting-started-with-dplyr.html#cb171-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medGDPc =</span> <span class="fu">median</span>(gdpPercap)) <span class="sc">%&gt;%</span></span>
<span id="cb171-5"><a href="getting-started-with-dplyr.html#cb171-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(medGDPc))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   continent medGDPc
##   &lt;fct&gt;       &lt;dbl&gt;
## 1 Oceania    17284.
## 2 Europe     14226.
## 3 Americas    6281.
## 4 Asia        3195.
## 5 Africa      1400.</code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Calculate the mean and standard deviation of life expectancy for separately for each continent in every year <em>after</em> 1977. Sort your results in ascending order by the standard deviation of life expectancy.</li>
</ol>
<div class='webex-solution'>
<button>
Show Solution
</button>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="getting-started-with-dplyr.html#cb173-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb173-2"><a href="getting-started-with-dplyr.html#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1977</span>) <span class="sc">%&gt;%</span></span>
<span id="cb173-3"><a href="getting-started-with-dplyr.html#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb173-4"><a href="getting-started-with-dplyr.html#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">meanGDPc =</span> <span class="fu">mean</span>(gdpPercap), <span class="at">sdGDPc =</span> <span class="fu">sd</span>(gdpPercap)) <span class="sc">%&gt;%</span></span>
<span id="cb173-5"><a href="getting-started-with-dplyr.html#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sdGDPc)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;continent&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 30 × 4
## # Groups:   continent [5]
##    continent  year meanGDPc sdGDPc
##    &lt;fct&gt;     &lt;int&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1 Oceania    1982   18555.  1304.
##  2 Oceania    1987   20448.  2038.
##  3 Africa     1987    2283.  2567.
##  4 Africa     1992    2282.  2644.
##  5 Africa     1997    2379.  2821.
##  6 Africa     2002    2599.  2973.
##  7 Africa     1982    2482.  3243.
##  8 Oceania    1992   20894.  3579.
##  9 Africa     2007    3089.  3618.
## 10 Oceania    1997   24024.  4206.
## # … with 20 more rows</code></pre>
</div>
</div>
</div>
<div id="understanding-the-pipe" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Understanding the pipe: <code>%&gt;%</code></h2>
<p>Let's revisit the pipe, <code>%&gt;%</code>, that we've used in the code examples above.
I told you that the command <code>gapminder %&gt;% filter(year == 2007)</code> "pipes" the tibble <code>gapminder</code> into the function <code>filter()</code>.
But what exactly does this mean?
Take a look at the R help file for the <code>dplyr</code> function <code>filter</code>.
We see that <code>filter()</code> takes something called <code>.data</code> as its first argument.
Moving on to the "Arguments" section of the help file, we see that <code>.data</code> is "A tbl" i.e. a tibble.
To better understand what this means, let's try using <code>filter</code> <em>without</em> the pipe:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="getting-started-with-dplyr.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, year <span class="sc">==</span> <span class="dv">2007</span>, country <span class="sc">==</span> <span class="st">&#39;United States&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   country       continent  year lifeExp       pop gdpPercap
##   &lt;fct&gt;         &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
## 1 United States Americas   2007    78.2 301139947    42952.</code></pre>
<p>Notice that this gives us <em>exactly</em> the same result as</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="getting-started-with-dplyr.html#cb178-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb178-2"><a href="getting-started-with-dplyr.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>, country <span class="sc">==</span> <span class="st">&#39;United States&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   country       continent  year lifeExp       pop gdpPercap
##   &lt;fct&gt;         &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
## 1 United States Americas   2007    78.2 301139947    42952.</code></pre>
<p>In other words <strong><em>The pipe is gives us an alternative way of supplying the first argument to a function</em></strong>.
Let's try this with a more familiar R function: <code>mean</code>.
The first argument of <code>mean</code> is a vector <code>x</code>.
So let's try using the pipe to compute the mean of some data:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="getting-started-with-dplyr.html#cb180-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">2</span>)</span>
<span id="cb180-2"><a href="getting-started-with-dplyr.html#cb180-2" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span> mean</span></code></pre></div>
<pre><code>## [1] 3.4</code></pre>
<p>The pipe supplies a function with its <em>first</em> argument.
If we want to specify additional arguments, we need to do so within the function call itself.
For example, here's how we could use the pipe to compute the mean after dropping missing observations:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="getting-started-with-dplyr.html#cb182-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="cn">NA</span>, <span class="dv">7</span>, <span class="dv">2</span>)</span>
<span id="cb182-2"><a href="getting-started-with-dplyr.html#cb182-2" aria-hidden="true" tabindex="-1"></a>y <span class="sc">%&gt;%</span> </span>
<span id="cb182-3"><a href="getting-started-with-dplyr.html#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 3.75</code></pre>
<p>One important note about the pipe: it's <em>not</em> a base R command.
Instead it's a command provided by the package <code>Magrittr</code>.
(If you're familiar with the Belgian painter Magritte, you may realize that the name of this package is quite witty!)
This package is installed automatically along with <code>dplyr</code>.</p>
<div id="exercise-4" class="section level3" number="2.8.1">
<h3><span class="header-section-number">2.8.1</span> Exercise</h3>
<ol style="list-style-type: decimal">
<li>Write R code that uses the pipe to calculate the sample variance of <code>z &lt;- c(4, 1, 5, NA, 3)</code> excluding the missing observation from the calculation.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="getting-started-with-dplyr.html#cb184-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="cn">NA</span>, <span class="dv">3</span>)</span>
<span id="cb184-2"><a href="getting-started-with-dplyr.html#cb184-2" aria-hidden="true" tabindex="-1"></a>z <span class="sc">%&gt;%</span> <span class="fu">var</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 2.916667</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Re-write the code from your solution to Exercise #4 <em>without</em> using the pipe.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="getting-started-with-dplyr.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(gapminder,lifeExp)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 6
##    country      continent  year lifeExp     pop gdpPercap
##    &lt;fct&gt;        &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;
##  1 Rwanda       Africa     1992    23.6 7290203      737.
##  2 Afghanistan  Asia       1952    28.8 8425333      779.
##  3 Gambia       Africa     1952    30    284320      485.
##  4 Angola       Africa     1952    30.0 4232095     3521.
##  5 Sierra Leone Africa     1952    30.3 2143249      880.
##  6 Afghanistan  Asia       1957    30.3 9240934      821.
##  7 Cambodia     Asia       1977    31.2 6978607      525.
##  8 Mozambique   Africa     1952    31.3 6446316      469.
##  9 Sierra Leone Africa     1957    31.6 2295678     1004.
## 10 Burkina Faso Africa     1952    32.0 4469979      543.
## # … with 1,694 more rows</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="getting-started-with-dplyr.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(gapminder, <span class="fu">desc</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 6
##    country          continent  year lifeExp       pop gdpPercap
##    &lt;fct&gt;            &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1 Japan            Asia       2007    82.6 127467972    31656.
##  2 Hong Kong, China Asia       2007    82.2   6980412    39725.
##  3 Japan            Asia       2002    82   127065841    28605.
##  4 Iceland          Europe     2007    81.8    301931    36181.
##  5 Switzerland      Europe     2007    81.7   7554661    37506.
##  6 Hong Kong, China Asia       2002    81.5   6762476    30209.
##  7 Australia        Oceania    2007    81.2  20434176    34435.
##  8 Spain            Europe     2007    80.9  40448191    28821.
##  9 Sweden           Europe     2007    80.9   9031088    33860.
## 10 Israel           Asia       2007    80.7   6426679    25523.
## # … with 1,694 more rows</code></pre>
</div>
</div>
</div>
<div id="chaining-commands" class="section level2" number="2.9">
<h2><span class="header-section-number">2.9</span> Chaining commands</h2>
<p>In the examples we've looked at so far, the pipe doesn't seem all that useful: it's just an alternative way of specifying the first argument to a function.
The true power and convenience of the pipe only becomes apparent we need to <em>chain</em> a series of commands together.
For example, suppose we wanted to display the 1952 data from <code>gapminder</code> sorted by <code>gdpPercap</code> in descending order.
Using the pipe, this is easy:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="getting-started-with-dplyr.html#cb190-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb190-2"><a href="getting-started-with-dplyr.html#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1952</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb190-3"><a href="getting-started-with-dplyr.html#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(gdpPercap))</span></code></pre></div>
<pre><code>## # A tibble: 142 × 6
##    country        continent  year lifeExp       pop gdpPercap
##    &lt;fct&gt;          &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1 Kuwait         Asia       1952    55.6    160000   108382.
##  2 Switzerland    Europe     1952    69.6   4815000    14734.
##  3 United States  Americas   1952    68.4 157553000    13990.
##  4 Canada         Americas   1952    68.8  14785584    11367.
##  5 New Zealand    Oceania    1952    69.4   1994794    10557.
##  6 Norway         Europe     1952    72.7   3327728    10095.
##  7 Australia      Oceania    1952    69.1   8691212    10040.
##  8 United Kingdom Europe     1952    69.2  50430000     9980.
##  9 Bahrain        Asia       1952    50.9    120447     9867.
## 10 Denmark        Europe     1952    70.8   4334000     9692.
## # … with 132 more rows</code></pre>
<p>Notice how I split the commands across multiple lines.
This is good practice: it makes your code much easier to read.
So what's happening when we chain commands in this way?
The first step in the chain <code>gapminder %&gt;% filter(year == 1952)</code> returns a tibble: the subset of <code>gapminder</code> for which <code>year</code> is <code>1952</code>.
The next step <code>%&gt;% arrange(gdpPercap)</code> pipes this <em>new</em> tibble into the function <code>arrange()</code>, giving us the desired result.
I hope you agree with me that this is pretty intuitive: even if we didn't know anything about <code>dplyr</code> we could <em>almost</em> figure out what this code is supposed to do.
In stark contrast, let's look at the code we'd have to use if we wanted to accomplish the same task <em>without</em> using the pipe:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="getting-started-with-dplyr.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(<span class="fu">filter</span>(gapminder, year <span class="sc">==</span> <span class="dv">1952</span>), </span>
<span id="cb192-2"><a href="getting-started-with-dplyr.html#cb192-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">desc</span>(gdpPercap))</span></code></pre></div>
<pre><code>## # A tibble: 142 × 6
##    country        continent  year lifeExp       pop gdpPercap
##    &lt;fct&gt;          &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1 Kuwait         Asia       1952    55.6    160000   108382.
##  2 Switzerland    Europe     1952    69.6   4815000    14734.
##  3 United States  Americas   1952    68.4 157553000    13990.
##  4 Canada         Americas   1952    68.8  14785584    11367.
##  5 New Zealand    Oceania    1952    69.4   1994794    10557.
##  6 Norway         Europe     1952    72.7   3327728    10095.
##  7 Australia      Oceania    1952    69.1   8691212    10040.
##  8 United Kingdom Europe     1952    69.2  50430000     9980.
##  9 Bahrain        Asia       1952    50.9    120447     9867.
## 10 Denmark        Europe     1952    70.8   4334000     9692.
## # … with 132 more rows</code></pre>
<p>There are may reasons why this code is harder to read, but the most important one is that the commands <code>arrange</code> and <code>filter</code> have to appear in the code in the <em>opposite</em> of the order in which they are actually being carried out.
This is because parentheses are evaluated from <em>inside to outside</em>.
This is what's great about the pipe: it lets us write our code in a way that accords with the actual order of the steps we want to carry out.</p>
<div id="exercise-5" class="section level3" number="2.9.1">
<h3><span class="header-section-number">2.9.1</span> Exercise</h3>
<ol style="list-style-type: decimal">
<li>What was the most populous European country in 1992? Write appropriate <code>dplyr</code> code using the pipe to display the information you need to answer this question.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="getting-started-with-dplyr.html#cb194-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb194-2"><a href="getting-started-with-dplyr.html#cb194-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1992</span>, continent <span class="sc">==</span> <span class="st">&#39;Europe&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb194-3"><a href="getting-started-with-dplyr.html#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pop))</span></code></pre></div>
<pre><code>## # A tibble: 30 × 6
##    country        continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;          &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Germany        Europe     1992    76.1 80597764    26505.
##  2 Turkey         Europe     1992    66.1 58179144     5678.
##  3 United Kingdom Europe     1992    76.4 57866349    22705.
##  4 France         Europe     1992    77.5 57374179    24704.
##  5 Italy          Europe     1992    77.4 56840847    22014.
##  6 Spain          Europe     1992    77.6 39549438    18603.
##  7 Poland         Europe     1992    71.0 38370697     7739.
##  8 Romania        Europe     1992    69.4 22797027     6598.
##  9 Netherlands    Europe     1992    77.4 15174244    26791.
## 10 Hungary        Europe     1992    69.2 10348684    10536.
## # … with 20 more rows</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Re-write your code from part 1. <em>without</em> using the pipe.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="getting-started-with-dplyr.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(<span class="fu">filter</span>(gapminder, year <span class="sc">==</span> <span class="dv">1992</span>, continent <span class="sc">==</span> <span class="st">&#39;Europe&#39;</span>), <span class="fu">desc</span>(pop))</span></code></pre></div>
<pre><code>## # A tibble: 30 × 6
##    country        continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;          &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Germany        Europe     1992    76.1 80597764    26505.
##  2 Turkey         Europe     1992    66.1 58179144     5678.
##  3 United Kingdom Europe     1992    76.4 57866349    22705.
##  4 France         Europe     1992    77.5 57374179    24704.
##  5 Italy          Europe     1992    77.4 56840847    22014.
##  6 Spain          Europe     1992    77.6 39549438    18603.
##  7 Poland         Europe     1992    71.0 38370697     7739.
##  8 Romania        Europe     1992    69.4 22797027     6598.
##  9 Netherlands    Europe     1992    77.4 15174244    26791.
## 10 Hungary        Europe     1992    69.2 10348684    10536.
## # … with 20 more rows</code></pre>
</div>
</div>
</div>
<div id="change-an-existing-variable-or-create-a-new-one-with-mutate" class="section level2" number="2.10">
<h2><span class="header-section-number">2.10</span> Change an existing variable or create a new one with <code>mutate</code></h2>
<p>It's a little hard to read the column <code>pop</code> in <code>gapminder</code> since there are so many digits.
Suppose that, instead of raw population, we wanted to display population <em>in millions</em>.
This requires us to <code>pop</code> by <code>1000000</code>, which we can do using the function <code>mutate()</code> from <code>dplyr</code> as follows:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="getting-started-with-dplyr.html#cb198-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb198-2"><a href="getting-started-with-dplyr.html#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pop =</span> pop <span class="sc">/</span> <span class="dv">1000000</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 6
##    country     continent  year lifeExp   pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8.43      779.
##  2 Afghanistan Asia       1957    30.3  9.24      821.
##  3 Afghanistan Asia       1962    32.0 10.3       853.
##  4 Afghanistan Asia       1967    34.0 11.5       836.
##  5 Afghanistan Asia       1972    36.1 13.1       740.
##  6 Afghanistan Asia       1977    38.4 14.9       786.
##  7 Afghanistan Asia       1982    39.9 12.9       978.
##  8 Afghanistan Asia       1987    40.8 13.9       852.
##  9 Afghanistan Asia       1992    41.7 16.3       649.
## 10 Afghanistan Asia       1997    41.8 22.2       635.
## # … with 1,694 more rows</code></pre>
<p>Note the syntax here: within <code>mutate()</code> we have an assignment statement, namely <code>pop = pop / 1000000</code>.
This tells R to calculate <code>pop / 1000000</code> and assign the result to <code>pop</code>, in place of the original variable.</p>
<p>We can also use <code>mutate()</code> to create a new variable.
The <code>gapminder</code> dataset doesn't contain overall GDP, only GDP per capita.
To calculate GDP, we need to multiply <code>gdpPercap</code> by <code>pop</code>.
But wait!
Didn't we just change pop so it's expressed in millions?
No: we never <em>stored</em> the results of our previous command, we simply displayed them.
Just as I discussed above, unless you <em>overwrite</em> it, the original <code>gapminder</code> dataset will be unchanged.
With this in mind, we can create the <code>gdp</code> variable as follows:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="getting-started-with-dplyr.html#cb200-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb200-2"><a href="getting-started-with-dplyr.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gdp =</span> pop <span class="sc">*</span> gdpPercap)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 7
##    country     continent  year lifeExp      pop gdpPercap          gdp
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.  6567086330.
##  2 Afghanistan Asia       1957    30.3  9240934      821.  7585448670.
##  3 Afghanistan Asia       1962    32.0 10267083      853.  8758855797.
##  4 Afghanistan Asia       1967    34.0 11537966      836.  9648014150.
##  5 Afghanistan Asia       1972    36.1 13079460      740.  9678553274.
##  6 Afghanistan Asia       1977    38.4 14880372      786. 11697659231.
##  7 Afghanistan Asia       1982    39.9 12881816      978. 12598563401.
##  8 Afghanistan Asia       1987    40.8 13867957      852. 11820990309.
##  9 Afghanistan Asia       1992    41.7 16317921      649. 10595901589.
## 10 Afghanistan Asia       1997    41.8 22227415      635. 14121995875.
## # … with 1,694 more rows</code></pre>
<div id="exercise-6" class="section level3" number="2.10.1">
<h3><span class="header-section-number">2.10.1</span> Exercise</h3>
<ol style="list-style-type: decimal">
<li>Explain why we used <code>=</code> rather than <code>==</code> in the <code>mutate()</code> examples above.</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<p>We used <code>=</code> because we're carrying out an <em>assignment operation</em>. In contrast <code>==</code> tests for equality, returning <code>TRUE</code> or <code>FALSE</code>.</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Calculate life expectancy <em>in months</em> and use it to answer the following question: "which country in the Americas had the shortest life expectancy <em>in months</em> in the year 1962?"</li>
</ol>
<div class="webex-solution">
<button>
Show Solution
</button>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="getting-started-with-dplyr.html#cb202-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb202-2"><a href="getting-started-with-dplyr.html#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lifeExpMonths =</span> <span class="dv">12</span> <span class="sc">*</span> lifeExp) <span class="sc">%&gt;%</span></span>
<span id="cb202-3"><a href="getting-started-with-dplyr.html#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1962</span>, continent <span class="sc">==</span> <span class="st">&#39;Americas&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb202-4"><a href="getting-started-with-dplyr.html#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(lifeExpMonths)</span></code></pre></div>
<pre><code>## # A tibble: 25 × 7
##    country            continent  year lifeExp      pop gdpPercap lifeExpMonths
##    &lt;fct&gt;              &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;         &lt;dbl&gt;
##  1 Bolivia            Americas   1962    43.4  3593918     2181.          521.
##  2 Haiti              Americas   1962    43.6  3880130     1797.          523.
##  3 Guatemala          Americas   1962    47.0  4208858     2750.          563.
##  4 Honduras           Americas   1962    48.0  2090162     2291.          576.
##  5 Nicaragua          Americas   1962    48.6  1590597     3634.          584.
##  6 Peru               Americas   1962    49.1 10516500     4957.          589.
##  7 El Salvador        Americas   1962    52.3  2747687     3777.          628.
##  8 Dominican Republic Americas   1962    53.5  3453434     1662.          642.
##  9 Ecuador            Americas   1962    54.6  4681707     4086.          656.
## 10 Brazil             Americas   1962    55.7 76039390     3337.          668.
## # … with 15 more rows</code></pre>
</div>

</div>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="the-hot-hand.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="getting-started-with-ggplot2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
